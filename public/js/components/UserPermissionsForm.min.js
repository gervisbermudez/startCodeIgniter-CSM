var UserPermissionsForm=new Vue({el:"#root",data:{loader:!0,editMode:!1,usergroup_id:null,name:"New User Group",description:"Describe the user group",level:null,status:!1,date_publish:"",date_create:"",date_update:"",permissions:[],user_id:null,parent_id:null,user:null,data:1,usergroup_permisions:[],usergroups:[]},mixins:[mixins],computed:{btnEnable:function(){return!!this.name},checkedPermissions:function(){return this.permissions.filter(e=>e.enabled)}},methods:{autoSave(){this.status||(this.runSaveData(),this.debug&&console.log("running autosave..."))},save(){this.loader=!0,this.runSaveData(e=>{M.toast({html:"<span>Group saved </span>"})})},runSaveData(e){var s=this,t=BASEURL+"api/v1/users/usergroups";$.ajax({type:"POST",url:t,data:s.getData(),dataType:"json",success:function(i){s.debug&&console.log(t,i),setTimeout(()=>{s.loader=!1},1500),200==i.code?(s.editMode=!0,s.usergroup_id=i.data.usergroup_id,"function"==typeof e&&e(i)):(M.toast({html:i.error_message}),s.loader=!1)},error:function(e){s.loader=!1,M.toast({html:"Ocurrió un error inesperado"}),console.error(error)}})},isChecked(e){return this.usergroup_permisions.includes(e)},getData:function(){return{usergroup_id:this.usergroup_id||"",name:this.name||"",level:this.level||"",description:this.description||"",status:this.status?1:0,parent_id:this.parent_id,permissions:this.checkedPermissions}},getUserGroups:function(){var e=this,s=BASEURL+"api/v1/users/usergroups/";fetch(s).then(e=>e.json()).then(s=>{let t=s.data;t.map(e=>(e.user?e.user=new User(e.user):e.user=new User({}),e)),e.usergroups=t,e.loader=!1,this.initPlugins()}).catch(s=>{e.loader=!1,M.toast({html:"Ocurrió un error inesperado"}),console.error(error)})},getPermissions(){var e=BASEURL+"api/v1/users/permissions/";fetch(e).then(e=>e.json()).then(s=>{if(this.debug&&console.log(e,s),200==s.code){this.permissions=s.data.map((e,s)=>{let t=e.permission.permision_name,i=t.split("_")[0],r=t.substring(t.indexOf("_")+1);return{...e.permission,permission_type:i,module:r,enabled:this.usergroup_permisions.includes(t)}});let e=function(e,s){return e.module<s.module?-1:e.module>s.module?1:0};this.permissions=this.permissions.sort(e)}}).catch(e=>{this.debug&&console.log(e),this.loader=!1})},checkEditMode(){if(usergroup_id&&"edit"==editMode){this.editMode=!0;var e=BASEURL+"api/v1/users/usergroups/"+usergroup_id;fetch(e).then(e=>e.json()).then(s=>{if(this.loader=!1,this.debug&&console.log(e,s),200==s.code){let e=s.data;this.usergroup_id=e.usergroup_id,this.name=e.name,this.description=e.description,this.level=e.level,this.date_create=e.date_create,this.date_update=e.date_update,this.status=e.status,this.user_id=e.user_id,this.level=e.level,this.usergroup_permisions=e.usergroup_permisions,this.parent_id=e.parent_id,this.user=new User(e.user)}this.initPlugins(),this.getPermissions()}).catch(e=>{M.toast({html:e.error_message}),self.loader=!1})}else this.getPermissions(),this.loader=!1},initPlugins(){setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},3e3)},checkAll(e,s){this.setChecked(e.target.checked,s)},setChecked:function(e,s){this.permissions=this.permissions.map(t=>(t.permission_type==s&&(t.enabled=e),t))}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("mounted UserPermissionsForm"),this.checkEditMode()}))}});