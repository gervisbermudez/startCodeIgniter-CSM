var FormNewModule=new Vue({el:"#root",data:{debug:DEBUGMODE,editMode:!1,loader:!0,form_name:"Nuevo Formulario",form_description:"",date_create:null,date_update:null,user:{},status:!0,tabs:[],custom_model_id:null,formsElements:formsElements,configurable:!0},methods:{getInitialTab(){return{tab_name:"Tab "+(this.tabs.length+1),tabID:this.makeid(10),custom_model_tab_id:null,custom_model_fields:[],edited:!0,active:!0,status:!0}},setActive(t){this.tabs.map(t=>(t.active=!1,t)),this.tabs[t].active=!0},addTab(){this.debug&&console.log("addTab trigger"),this.tabs.push(this.getInitialTab()),this.setActive(this.tabs.length-1)},saveTab(t){this.debug&&console.log("saveTab trigger"),this.tabs[t].edited=!1},makeid(t){for(var e="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=s.length,o=0;o<t;o++)e+=s.charAt(Math.floor(Math.random()*a));return e},deleteTab(t){if(this.debug&&console.log("deleteTab trigger"),1==this.tabs.length)return!1;this.tabs.splice(t,1)},getActiveTab(){let t;return this.tabs.forEach((e,s)=>{e.active&&(t=s)}),t},addField(t){this.debug&&console.log("addField trigger"),this.tabs[this.getActiveTab()].custom_model_fields.push(JSON.parse(JSON.stringify(t))),setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{});t=document.querySelectorAll(".tooltipped"),M.Tooltip.init(t,{});M.AutoInit()},2e3)},removeField(t,e){"formTextFormat"==this.tabs[t].custom_model_fields[e].component?(this.getfieldsData(),editor=this.tabs[t].custom_model_fields[e].data,tinymce.editors[editor.fieldID].destroy(),this.tabs[t].custom_model_fields.splice(e,1)):this.tabs[t].custom_model_fields.splice(e,1)},getfieldsData(){this.debug&&console.log("getfieldsData trigger"),fieldsComponents=FormNewModule.$refs;for(const t in fieldsComponents)if(fieldsComponents.hasOwnProperty(t)){const e=fieldsComponents[t];for(let t=0;t<e.length;t++){const s=e[t];FormNewModule.setFieldData(s.tabParent.tabID,s.fieldRefIndex,JSON.parse(JSON.stringify(s.getData())))}}},setFieldData(t,e,s){this.debug&&console.log("setFieldData trigger"),this.tabs.map(a=>{a.tabID==t&&(a.custom_model_fields[e].data=s)})},getFormData(){return this.getfieldsData(),{custom_model_id:this.custom_model_id,form_name:this.form_name,form_description:this.form_description,date_create:this.date_create,date_update:this.date_update,status:this.status?1:0,user:this.user,tabs:this.tabs}},saveData(){$("html, body").animate({scrollTop:0},600),this.loader=!0,this.debug&&console.log("saveData trigger");var t=this.getFormData(),e=BASEURL+"api/v1/forms",s=this;$.ajax({type:"POST",url:e,data:{data:JSON.stringify(t)},dataType:"json",success:function(t){s.debug&&console.log(e,t),t.data&&(s.custom_model_id=t.data.custom_model_id,s.editMode=!0,s.loader=!1,M.toast({html:`<span>Formulario Guardado</span> <a class="btn-flat toast-action" href="${BASEURL+"admin/CustomModels/addData/"+s.custom_model_id}"> Agregar Data</a>`}))},error:function(t){s.loader=!1,M.toast({html:t.error_message})}})},checkEditMode(){if("undefined"!=typeof custom_model_id){this.editMode=!0,this.custom_model_id=custom_model_id,console.log("editMode",this.editMode);var t=this,e=BASEURL+"api/v1/models/"+custom_model_id;$.ajax({type:"GET",url:e,data:{},dataType:"json",success:function(s){t.debug&&console.log(e,s),"200"==s.code&&t.updateFormData(s.data)},error:function(e){t.loader=!1,M.toast({html:"OcurriÃ³ un error"})}})}else this.loader=!1},updateFormData(t){this.serverdata=t,this.form_name=t.form_name,this.form_description=t.form_description,this.date_create=t.date_create,this.date_update=t.date_update,this.status="1"==t.status,this.user=t.user,this.tabs=t.tabs.map((t,e)=>({edited:!1,active:!1,tab_name:t.tab_name,status:"1"==t.status,custom_model_tab_id:t.custom_model_tab_id,custom_model_fields:t.custom_model_fields?t.custom_model_fields:[],tabID:this.makeid(10)})),this.tabs[0].active=!0,setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{}),this.loader=!1},2e3)}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("FormNewModule mounted"),this.tabs.push(this.getInitialTab()),this.tabs[0].edited=!1,this.checkEditMode()}))}});