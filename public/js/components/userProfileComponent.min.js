var userProfile=new Vue({el:"#root",data:{debug:DEBUGMODE,loader:!0,user:new User,timelineData:[]},mixins:[mixins],watch:{"user.user_id":function(e){$("#input-100").data("fileinput")&&($("#input-100").data("fileinput").uploadExtraData.curDir="./public/img/profile/"+this.user.username+"/")}},filters:{shortDate:function(e){return e.split("at")[0]}},methods:{getcontentText:function(e){var t=document.createElement("span");return t.innerHTML=e.content,(t.textContent||t.innerText).substring(0,220)+"..."},getPageImagePath:e=>e.imagen_file?BASEURL+e.imagen_file.file_path.substr(2)+e.imagen_file.file_name+"."+e.imagen_file.file_type:BASEURL+"public/img/default.jpg",getPageFullPath:function(e){return 1==e.status?BASEURL+e.path:BASEURL+"admin/paginas/editar/"+e.page_id},getUser(){var e=this;e.loader=!0,e.users=[];var t=window.location.pathname.split("/")[4];if(t){var a=BASEURL+"api/v1/users/"+t;fetch(a).then(e=>e.json()).then(t=>{e.debug&&console.log(a,t),e.loader=!1,e.user=new User(t.data)}).catch(t=>{M.toast({html:t.error_message}),e.loader=!1})}},getUserTimeline(){var e=this;e.timelineData=[];var t=window.location.pathname.split("/")[4];if(t){var a=BASEURL+"/api/v1/users/timeline/"+t;fetch(a).then(e=>e.json()).then(t=>{e.debug&&console.log(a,t),e.loader=!1;let r=t.data.map((e,t)=>{switch(e.user&&(e.user=new User(e.user)),e.model_type){case"page":return new Page(e)}return e}),i={};r.forEach(e=>{let t=e.date_create.split(" ")[0]+" 00:00:00";null==i[t]&&(i[t]=[]),i[t].push(e)}),e.timelineData=i}).catch(t=>{M.toast({html:response.error_message}),e.loader=!1})}},updateAvatar(){var e=this;e.loader=!0,$.ajax({type:"POST",url:BASEURL+"api/v1/users/avatar",data:{avatar:e.user.user_data.avatar,user_id:e.user.user_id},dataType:"json",success:function(t){e.loader=!1},error:function(t){e.loader=!1,M.toast({html:"OcurriÃ³ un error inesperado"}),console.error(t)}})},base_url:function(e){return BASEURL+e},getAvatarUrl(e){return this.user.get_avatarurl()},initPlugins:function(){M.Tabs.init(document.getElementById("user-tabs"),{}),setTimeout(()=>{var e=document.querySelectorAll(".tooltipped");M.Tooltip.init(e,{});e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{})},4e3)},uploadCallback:function(e){M.Modal.getInstance($(".modal")).close(),console.log(e);let t=new ExplorerFile(e[0]);this.user.user_data.avatar=t.get_relative_file_path(),this.updateAvatar()}},mounted:function(){this.$nextTick((function(){this.getUser(),this.getUserTimeline(),this.initPlugins()}))}});