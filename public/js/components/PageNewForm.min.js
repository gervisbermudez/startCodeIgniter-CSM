var PageNewForm=new Vue({el:"#root",data:{loader:!0,editMode:!1,page_id:null,form:new VueForm({title:{value:null,required:!0,type:"username",maxLength:120,minLength:5,customPattern:/[a-zA-Z0-9,#.-\s]+/},subtitle:{value:null,required:!1,type:"username",maxLength:120,minLength:5,customPattern:/[a-zA-Z0-9,#.-\s]+/}}),status:!1,path:"",content:"",visibility:1,publishondate:!0,datepublish:"",timepublish:"",template:"default",categorie:1,subcategories:1},computed:{btnEnable:function(){let e=!!this.form.fields.title.value&&!!this.path&&!!this.content||!1;return e&&this.autoSave(),e},getDateTimePublish:function(){return this.datepublish&&this.timepublish?this.datepublish+" "+this.timepublish+":00":null}},watch:{"form.fields.title.value":function(e){this.setPath(e)},publishondate:function(e){e&&(this.datepublish="",this.timepublish="")}},methods:{autoSave(){console.log("running autosave...")},setPath(e){this.path=this.string_to_slug(e)},string_to_slug:function(e){if(0==e.length)return"";e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var t="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",a=0,i=t.length;a<i;a++)e=e.replace(new RegExp(t.charAt(a),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(a));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},validateField(e){let t=UserNewForm;if(!t.form.validateField(e))return t.form.fields[e].valid;t.serverValidation(e)},save(){var e=this;e.form.validate(),0==e.form.errors.length?(this.loader=!0,$.ajax({type:"POST",url:BASEURL+"admin/paginas/ajax_save_page",data:e.getData(),dataType:"json",success:function(t){200==t.code?(e.loader=!1,M.toast({html:"Success!!"}),setTimeout(()=>{window.location=BASEURL+"admin/paginas/"},2e3)):(M.toast({html:t.responseJSON.error_message}),e.loader=!1)},error:function(t){M.toast({html:t.responseJSON.error_message}),e.loader=!1}})):M.toast({html:"Verifique todos los campos del formulario"})},getData:function(){return{title:this.form.fields.title.value||"",subtitle:this.form.fields.subtitle.value||"",path:this.path||"",status:this.status?1:0,content:this.content||"",page_id:this.page_id||null,publishondate:this.publishondate,date_publish:this.getDateTimePublish,visibility:this.visibility,template:this.template,categorie:this.categorie||null,subcategories:this.subcategories||null}},serverValidation(e){var t=this;$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_check_field",data:{field:e,value:t.form.fields[e].value},dataType:"json",success:function(a){a.code&&(t.form.fields[e].valid=a.data,a.data?t.form.markFieldAsValid(e):t.form.fields[e].errorText="The "+e+" is already registered",t.$forceUpdate())}})},getUsergroups(){var e=this;$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_get_usergroups",data:{},dataType:"json",success:function(t){200==t.code&&(e.usergroups=t.data,setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},2e3),e.loader=!1)},error:function(t){M.toast({html:response.responseJSON.error_message}),e.loader=!1}})},checkEditMode(){var e=document.getElementById("page_id").value,t=document.getElementById("editMode").value;if(e&&"edit"==t){var a=this;a.editMode=!0,$.ajax({type:"POST",url:BASEURL+"admin/paginas/ajax_get_page",data:{page_id:e},dataType:"json",success:function(e){200==e.code&&(console.log(e),a.form.fields.title.value=e.data.title,a.form.fields.subtitle.value=e.data.subtitle,a.page_id=e.data.page_id,a.status=!!e.data.status,a.visibility=e.data.visibility,a.publishondate=!!e.data.date_publish,a.template=e.data.template,a.categorie=e.data.categorie||0,a.subcategories=e.data.subcategories||0,setTimeout(()=>{tinymce.editors.id_cazary.setContent(e.data.content),a.content=e.data.content},2e3)),a.loader=!1,setTimeout(()=>{M.updateTextFields()},1e3)},error:function(e){M.toast({html:response.responseJSON.error_message}),a.loader=!1}})}},initPlugins(){tinymce.init({selector:"textarea",plugins:["link table code"],setup:function(e){e.on("Change",(function(e){PageNewForm.content=tinymce.editors.id_cazary.getContent()}))}}),setTimeout(()=>{var e=document.querySelectorAll(".datepicker");M.Datepicker.init(e,{format:"yyyy-mm-dd",onClose:function(){PageNewForm.datepublish=document.getElementById("datepublish").value}});e=document.querySelectorAll(".timepicker");M.Timepicker.init(e,{twelveHour:!1,defaultTime:"now",onCloseEnd:function(){PageNewForm.timepublish=document.getElementById("timepublish").value}})},1e3)}},mounted:function(){this.$nextTick((function(){console.log("mounted PageNewForm"),this.loader=!1,this.initPlugins(),this.checkEditMode()}))}});