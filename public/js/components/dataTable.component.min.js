var dataTable=Vue.component("dataTable",{template:"#dataTableComponent-template",props:{endpoint:{type:String,required:!1},index_data:{type:String,required:!1},hideids:{type:Boolean,default:!1},colums:{type:Array,required:!1,default:null},pagination:{type:Boolean,required:!1,default:!1},search_input:{type:Boolean,required:!1,default:!0},show_empty_input:{type:Boolean,required:!1,default:!0},module:{type:String,required:!1},preset_data:{type:Array,required:!1,default:null},options:{type:Array,required:!1,default:null}},data:function(){return{data:[],showPagination:!1,paginator:{},paginatorLinks:[],labels:[{colum:"name",label:"Name"}],statusIcons:[{tooltip:"No permitido",icon:"not_interested"},{tooltip:"Permitido",icon:"publish"}],tableView:!1,loader:!0,filter:"",orderDataConf:{strPropertyName:null,sort_as:"asc"},toDeleteItem:{item:null,index:null}}},mixins:[mixins],computed:{filterData:function(){if(this.filter){let e=this.filter.toLowerCase();return this.data.filter((t,i)=>this.searchInObject(t,e))}return this.data}},methods:{toggleView:function(){this.tableView=!this.tableView,this.initPlugins()},set_paginatorLinks:function(){if(this.showPagination){let e=[];e.push({page:this.paginator.prev_page,label:'<i class="material-icons">chevron_left</i>',class:0==this.paginator.prev_page?"disabled":"waves-effect"});let t=this.rangodepaginas(this.paginator.current_page-0,2,this.paginator.total_pages);t=this.paginaEllipsis(t),t.includes(1)||e.push({page:1,label:1,class:1==this.paginator.current_page?"active":"waves-effect"}),console.log({pages:t});for(let i=1;i<=t.length;i++)"..."==t[i-1]?2===i?e.push({page:parseInt(t[i])-1,label:t[i-1],class:"waves-effect "}):e.push({page:parseInt(t[i-2])+1,label:t[i-1],class:"waves-effect "}):e.push({page:t[i-1],label:t[i-1],class:this.paginator.current_page==t[i-1]?"active":"waves-effect"});return t.includes(this.paginator.total_pages)||e.push({page:this.paginator.total_pages,label:this.paginator.total_pages,class:this.paginator.current_page==this.paginator.total_pages?"active":"waves-effect"}),e.push({page:this.paginator.next_page,label:'<i class="material-icons">chevron_right</i>',class:this.paginator.next_page>this.paginator.total_pages?"disabled":"waves-effect"}),this.paginatorLinks=e}return null},rangodepaginas:function(e,t,i){for(var a=e-t,s=e+t,n=[],r=1;r<=i;r++)(1===r||r===i||r>=a&&r<=s)&&n.push(r);return n},paginaEllipsis:function(e){var t=e.pop();e.push(t),rango_con_ellipsis=[];for(var i=1;i<e.length-1;i++)1===e[i-1]&&2!==e[i]&&(rango_con_ellipsis.push(1),rango_con_ellipsis.push("...")),rango_con_ellipsis.push(e[i]),e[i+1]===t&&e[i]!==t-1&&(rango_con_ellipsis.push("..."),rango_con_ellipsis.push(t));return rango_con_ellipsis},toggleEddit(e){e.editable=!e.editable,this.$forceUpdate()},resetFilter:function(){this.filter=""},pagerTo(e){this.getData(e)},initPlugins:function(){setTimeout(()=>{var e=document.querySelectorAll(".tooltipped");M.Tooltip.init(e,{});e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{});e=document.querySelectorAll(".collapsible");M.Collapsible.init(e,{});e=document.querySelectorAll("select");M.FormSelect.init(e,{})},3e3)},getData:function(e=1){var t=this;if(t.loader=!0,this.pagination)var i=BASEURL+this.endpoint+"?page="+e;else i=BASEURL+this.endpoint;fetch(i).then(e=>e.json()).then(e=>{let i=e.data;e.current_page&&this.pagination&&(this.showPagination=!0,this.paginator.current_page=e.current_page,this.paginator.per_page=e.per_page,this.paginator.total_rows=e.total_rows,this.paginator.offset=e.offset,this.paginator.total_pages=e.total_pages,this.paginator.first_page=e.first_page,this.paginator.last_page=e.last_page,this.paginator.next_page=e.next_page,this.paginator.prev_page=e.prev_page,this.set_paginatorLinks()),t.data=this.preProssesData(i),t.loader=!1,this.initPlugins()}).catch(e=>{t.loader=!1})},preProssesData(e){return e.map(e=>(e.user?e.user=new User(e.user):e.user=new User({}),e)),e.length&&!this.colums&&(this.labels=Object.keys(e[0]),this.hideids&&(this.labels=this.labels.filter(e=>-1==e.indexOf("_id"))),this.colums=this.labels.map(e=>({colum:e,label:e}))),e},getContent(e,t){let i=t.colum;if(t.format&&"function"==typeof t.format)return t.format(e,t);let a="";switch(i){case"user":a=`<a href="${e[i].get_profileurl()}">${e[i].get_fullname()}</a>`;break;case"status":a=`<span>\n                <i class="material-icons tooltipped" data-position="left" data-delay="50" data-tooltip="${this.statusIcons[e[i]].tooltip}">${this.statusIcons[e[i]].icon}</i>\n              </span>`;break;default:a=resolve(e,i)}return a},editItem(e,t){this.$listeners&&this.$listeners.edit?this.$emit("edit",{item:e,index:t}):this.$router.push({name:"edit",params:{data:{index:t,item:e}}})},routerPush({option:e,index:t,item:i}){console.log("routerPush",{option:e,item:i,index:t});let a={};e.params&&e.params.forEach(e=>{a[e]=i[e]}),this.$router.push({name:e.href,params:{...a,data:{index:t,item:i}}})},createItem(){this.$listeners&&this.$listeners.new?this.$emit("new"):this.$router.push({name:"edit",params:{data:{mode:"new"}}})},deleteItem(e,t){this.$listeners&&this.$listeners.delete?this.$emit("delete",{item:e,index:t}):this.tempDelete(e,t)},setToDeleteItem(e,t){this.toDeleteItem={item:e,index:t}},confirmCallback(e){console.log("confirmCallback",e),e&&this.deleteItem(this.toDeleteItem.item,this.toDeleteItem.index)},archiveItem(e,t){this.$listeners&&this.$listeners.archive&&this.$emit("archive",{item:e,index:t})},tempDelete:function(e,t){this.toDeleteItem.item=e,this.toDeleteItem.index=t},initPlugins:function(){setTimeout(()=>{var e=document.querySelectorAll(".tooltipped");M.Tooltip.init(e,{}),e=document.querySelectorAll(".dropdown-trigger"),M.Dropdown.init(e,{})},3e3)}},mounted:function(){this.$nextTick((function(){this.endpoint?this.getData():this.preset_data?(this.data=this.preProssesData(this.preset_data),this.loader=!1):this.loader=!1,this.$root.$on("eventing",e=>{this.data[e.index]=e.item})}))}});