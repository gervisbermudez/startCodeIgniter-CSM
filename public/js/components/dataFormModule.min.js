Vue.component("formFieldTitle",{template:"#formFieldTitle-template",props:["tab-parent","field-ref","field-ref-index","serve-data"],data:function(){return{fieldPlaceholder:"",fieldID:this.makeid(10),fieldName:"",fielApiID:"",data:{}}},methods:{convertfielApiID(){this.fielApiID=this.fieldName.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""),this.fieldPlaceholder=this.fieldName.toLowerCase()},makeid(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,i=0;i<e;i++)t+=a.charAt(Math.floor(Math.random()*o));return t},updateFielData(e){this.data.fieldValue=e}},mounted:function(){this.$nextTick((function(){for(const e in this.serveData)if(this.serveData.hasOwnProperty(e)){const t=this.serveData[e];this[e]=t}}))}});var dataFormModule=new Vue({el:"#dataFormModule",data:{debug:!0,editMode:!1,loader:!0,tabs:[],formsElements:[{name:"title",displayName:"Titulo",icon:"format_color_text",component:"formFieldTitle",data:{hola:"mundo"}},{name:"formatText",displayName:"Texto con formato",icon:"format_size",data:{hola:"mundo"}},{name:"image",displayName:"Imagen",icon:"image",data:{hola:"mundo"}},{name:"link",displayName:"Link",icon:"insert_link",data:{hola:"mundo"}},{name:"date",displayName:"Fecha",icon:"date_range",data:{hola:"mundo"}},{name:"timestamp",displayName:"Fecha y Hora",icon:"access_time",data:{hola:"mundo"}},{name:"number",displayName:"Numero",icon:"looks_one",data:{hola:"mundo"}},{name:"dropdown_select",displayName:"Select",icon:"list",data:{hola:"mundo"}},{name:"bolean",displayName:"Bolean",icon:"check_circle",data:{hola:"mundo"}}],form_name:"",form_status:!0,fieldsData:[]},computed:{getFormName(){return this.editMode?"Edit "+this.form_name:"New "+this.form_name}},methods:{getInitialTab(){return{name:"Tab "+(this.tabs.length+1),tabID:this.makeid(10),edited:!0,active:!0,fields:[]}},setActive(e){this.tabs.map(e=>(e.active=!1,e)),this.tabs[e].active=!0},addTab(){this.debug&&console.log("addTab trigger"),this.tabs.push(this.getInitialTab()),this.setActive(this.tabs.length-1)},saveTab(e){this.debug&&console.log("saveTab trigger"),this.tabs[e].edited=!1},makeid(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,i=0;i<e;i++)t+=a.charAt(Math.floor(Math.random()*o));return t},deleteTab(e){if(this.debug&&console.log("deleteTab trigger"),1==this.tabs.length)return!1;this.tabs.splice(e,1)},getActiveTab(){let e;return this.tabs.forEach((t,a)=>{t.active&&(e=a)}),e},addField(e){this.debug&&console.log("addField trigger"),this.tabs[this.getActiveTab()].fields.push(JSON.parse(JSON.stringify(e))),setTimeout(()=>{var e=document.querySelectorAll(".collapsible");M.Collapsible.init(e,{})},2e3)},getfieldsData(){this.debug&&console.log("getfieldsData trigger"),fieldsComponents=dataFormModule.$refs;for(const e in fieldsComponents)if(fieldsComponents.hasOwnProperty(e)){const t=fieldsComponents[e];for(let e=0;e<t.length;e++){const a=t[e];dataFormModule.setFieldData(a.tabParent.tabID,a.fieldRefIndex,JSON.parse(JSON.stringify(a.$data)))}}},setFieldData(e,t,a){this.debug&&console.log("setFieldData trigger"),this.tabs.map(o=>{o.tabID==e&&(o.fields[t].data=a)})},saveData(){this.loader=!0,$("html, body").animate({scrollTop:0},600),this.debug&&console.log("saveData trigger"),this.getfieldsData();let e={form_name:this.form_name,form_status:this.form_status?1:0,tabs:{}};this.tabs.forEach(t=>{if(t.fields.length<0)return!1;e.tabs[t.name]={tab_name:t.name,fields:t.fields}}),e.form_id=form_id,this.editMode?$.ajax({type:"POST",url:BASEURL+"admin/formularios/updateDataForm",data:{data:JSON.stringify(e)},dataType:"json",success:function(e){e.data&&(window.location=BASEURL+"admin/content")}}):$.ajax({type:"POST",url:BASEURL+"admin/formularios/saveDataForm",data:{data:JSON.stringify(e)},dataType:"json",success:function(e){e.data&&(window.location=BASEURL+"admin/content")}})},loadFormFields(){if("undefined"!=typeof form_id&&"undefined"!=typeof editMode){var e=this;e.editMode=editMode,e.form_id=form_id,this.debug&&console.log("editMode"),$.ajax({type:"GET",url:"/admin/formularios/get_form_info/"+form_id,data:{},dataType:"json",success:function(t){console.log(t),200==t.code&&t.data.length>0?e.updateFields(t.data):M.toast({html:"Ocurrio un error"})},error:function(e){M.toast({html:"Ocurrio un error"})}})}else this.loader=!1},checkEditMode(){if(form_content_id&&"undefined"!=typeof editMode){var e=this;e.editMode=editMode,e.form_id=form_id,this.debug&&console.log("editMode"),$.ajax({type:"POST",url:"/admin/formularios/ajax_get_forms_data/",data:{form_content_id:form_content_id},dataType:"json",success:function(t){this.debug&&console.log(t),200==t.code&&t.data.length>0?e.updateFieldsData(t.data):M.toast({html:"Ocurrio un error"})},error:function(e){M.toast({html:"Ocurrio un error"})}})}else this.loader=!1},updateFields(e){this.form_name=e[0].form_name,this.form_status="1"==e[0].status,this.loader=!1,this.tabs=[],e.forEach(e=>{let t=this.getInitialTab();t.edited=!1,t.active=!1,t.name=e.tab_name,console.log(e.fields_data);let a={};e.fields_data.forEach(e=>{a={component:e.component,displayName:e.displayName,icon:e.icon,name:e.field_name,serveData:e.dataconfigs},t.fields.push(a)}),this.tabs.push(t)}),this.tabs[0].active=!0},updateFieldsData(e){var t=this;t.fieldsData=e,values=JSON.parse(t.fieldsData[0].form_data),values.forEach(e=>{this.debug&&console.log(e);for(const a in e)if(e.hasOwnProperty(a)){const o=e[a];t.setFieldDataFromServe(a,o)}})},setFieldDataFromServe(e,t){fieldsComponents=dataFormModule.$refs;for(const a in fieldsComponents)if(fieldsComponents.hasOwnProperty(a)){const o=fieldsComponents[a];for(let a=0;a<o.length;a++){const i=o[a];this.debug&&console.log(i),i.fielApiID==e&&i.updateFielData(t),i.$forceUpdate()}}}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("dataFormModule mounted"),this.tabs.push(this.getInitialTab()),this.tabs[0].edited=!1,this.loadFormFields(),this.checkEditMode()}))}});