var ConfiguracionList=new Vue({el:"#root",data:{configurations:[],tableView:!1,loader:!0,filter:"",sectionActive:"home",routes:["home","analytics","seo","pixel","database","theme"],files:[],themes:[]},mixins:[mixins],computed:{seoConfigurations:function(){if(this.filter){let e=this.filter.toLowerCase();return this.configurations.filter((t,i)=>this.searchInObject(t,e)&&"seo"==t.config_type)}return this.filterConfigurations("seo")},generalConfigurations:function(){return this.filterConfigurations("general")},analyticsConfigurations:function(){return this.filterConfigurations("analytics")},seoConfigurations:function(){return this.filterConfigurations("seo")},pixelConfigurations:function(){return this.filterConfigurations("pixel")},themeConfigurations:function(){return this.filterConfigurations("theme")}},methods:{getConfig:function(e,t="config_name"){let i=null;return this.configurations.forEach(o=>{o[t]==e&&(i=o)}),i},getConfigValue:function(e,t="config_name"){let i=this.getConfig(e,t);return i?i.config_value:""},getConfigValueBoolean:function(e,t="config_name"){let i=this.getConfig(e,t);return i&&i.config_value==i.config_data.true},updateConfig(e,t="config_name"){value=e.target.value,config=this.getConfig(t),config.config_value=value,this.runSave(config)},updateConfigCheckbox(e,t="ANALYTICS_ACTIVE"){value=e.target.checked,config=this.getConfig(t),value?config.config_data.perm_values.forEach(e=>{e==config.config_data.true&&(value=e)}):config.config_data.perm_values.forEach(e=>{e!=config.config_data.true&&(value=e)}),config.config_value=value,this.runSave(config)},filterConfigurations:function(e){return this.configurations.filter((t,i)=>t.config_type==e)},changeSectionActive:function(e){switch(this.sectionActive=e,e){case"theme":this.getThemes();break;case"database":this.getDatabaseBackups()}var t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?section="+e;window.history.pushState({path:t},"",t)},getThemes(){fetch(BASEURL+"api/v1/config/themes").then(e=>e.json()).then(e=>{this.themes=e.data}).catch(e=>{console.log(e)})},getThemePreviewUrl:(e,t)=>t.preview?BASEURL+"themes/"+e+"/"+t.preview:BASEURL+"public/img/profile/default.png",changeTheme(e){let t=this.getConfig("THEME_PATH");t.config_value=e,this.saveConfig(t)},getThemeIsChecked(e){return this.getConfig("THEME_PATH").config_value==e},toggleView:function(){this.tableView=!this.tableView,this.initPlugins()},toggleEddit(e){e.editable=!e.editable,this.$forceUpdate()},resetFilter:function(){this.filter=""},initPlugins:function(){setTimeout(()=>{var e=document.querySelectorAll(".tooltipped");M.Tooltip.init(e,{});e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{});e=document.querySelectorAll(".collapsible");M.Collapsible.init(e,{});e=document.querySelectorAll("select");M.FormSelect.init(e,{})},3e3)},saveConfig(e){if(this.toggleEddit(e),"boolean"!=e.config_data){let t=new VueForm({field:{value:e.config_value,required:!0,type:e.config_data.validate_as,maxLength:e.config_data.max_lenght,minLength:e.config_data.min_lenght}});t.validate(),t.errors.length>0?(e.validate=!1,M.toast({html:"Verificar la configuracion del campo"})):(e.validate=!0,this.runSave(e))}else this.runSave(e)},runSave(e){var t=this,i=BASEURL+"api/v1/config";$.ajax({type:"POST",url:i,data:e,dataType:"json",success:function(e){t.debug&&console.log(i,e),200==e.code?("function"==typeof callBack&&callBack(e),M.toast({html:"Config Saved!"})):M.toast({html:e.responseJSON.error_message})},error:function(e){M.toast({html:e.responseJSON.error_message})}})},getconfigurations:function(){var e=this,t=BASEURL+"api/v1/config/";fetch(t).then(e=>e.json()).then(t=>{let i=t.data;for(const e in i)if(i.hasOwnProperty(e)){i[e].user=new User(i[e].user);try{i[e].config_data=JSON.parse(i[e].config_data)}catch(t){i[e].config_data={}}}e.configurations=i,e.loader=!1}).catch(t=>{M.toast({html:t.responseJSON.error_message}),e.loader=!1})},deleteConfiguration:function(e,t){var i=this;i.loader=!0,$.ajax({type:"DELETE",url:BASEURL+"api/v1/configuration/"+e.configuration_id,data:{},dataType:"json",success:function(e){200==e.code&&i.configurations.splice(t,1)},error:function(e){M.toast({html:response.responseJSON.error_message}),i.loader=!1}})},base_url:function(e){return BASEURL+e},reloadFileExplorer(){var e=this;e.files=[];var t=BASEURL+"api/v1/files/reload_file_explorer";$.ajax({type:"POST",url:t,data:{path:"./backups/database/"},dataType:"json",success:function(t){e.getDatabaseBackups()}})},getDatabaseBackups(){var e=this;$.ajax({type:"GET",url:BASEURL+"api/v1/files/",data:{path:"./backups/database/"},dataType:"json",success:function(t){e.fileloader=!1,200==t.code&&t.data.length?e.files=t.data.map(e=>new ExplorerFile(e)):e.files=[]}})},deleteFile(e){var t=this;e=e;$.ajax({type:"POST",url:BASEURL+"api/v1/files/delete/"+e.file_id,data:{file:e},dataType:"json",success:function(e){if(200==e.code){html="<span>Done! </span>",M.toast({html:html}),t.getDatabaseBackups();var i=document.querySelectorAll(".collapsible");M.Collapsible.init(i,{})}}})},createDatabaseBackup(){fetch(BASEURL+"api/v1/config/backup_database").then(e=>e.json()).then(e=>{"200"==e.code?(M.toast({html:e.result}),this.reloadFileExplorer()):M.toast({html:e.result})}).catch(e=>{M.toast({html:"Error code: 001"})})}},mounted:function(){this.$nextTick((function(){this.getconfigurations(),window.addEventListener("popstate",e=>{try{var t=location.search.substring(1);(t=JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(e,t){return""===e?t:decodeURIComponent(t)}))).section&&this.routes.includes(t.section)?this.sectionActive=t.section:this.sectionActive="home"}catch(e){this.sectionActive="home"}},!1);try{var e=location.search.substring(1);(e=JSON.parse('{"'+e.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(e,t){return""===e?t:decodeURIComponent(t)}))).section&&this.routes.includes(e.section)&&this.changeSectionActive(e.section)}catch(e){this.changeSectionActive("home")}}))}});