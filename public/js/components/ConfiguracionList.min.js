var ConfiguracionList=new Vue({el:"#root",data:{configurations:[],tableView:!1,loader:!0,filter:"",sectionActive:"home",routes:["home","analytics","seo","pixel"]},mixins:[mixins],computed:{seoConfigurations:function(){if(this.filter){let t=this.filter.toLowerCase();return this.configurations.filter((e,i)=>this.searchInObject(e,t)&&"seo"==e.config_type)}return this.filterConfigurations("seo")},generalConfigurations:function(){return this.filterConfigurations("general")},analyticsConfigurations:function(){return this.filterConfigurations("analytics")},seoConfigurations:function(){return this.filterConfigurations("seo")},pixelConfigurations:function(){return this.filterConfigurations("pixel")}},methods:{getConfig:function(t,e="config_name"){let i=null;return this.configurations.forEach(n=>{n[e]==t&&(i=n)}),i},getConfigValue:function(t,e="config_name"){let i=this.getConfig(t,e);return i?i.config_value:""},getConfigValueBoolean:function(t,e="config_name"){let i=this.getConfig(t,e);return i&&i.config_value==i.config_data.true},updateConfig(t,e="config_name"){value=t.target.value,config=this.getConfig(e),config.config_value=value,this.runSave(config)},updateConfigCheckbox(t,e="ANALYTICS_ACTIVE"){value=t.target.checked,config=this.getConfig(e),value?config.config_data.perm_values.forEach(t=>{t==config.config_data.true&&(value=t)}):config.config_data.perm_values.forEach(t=>{t!=config.config_data.true&&(value=t)}),config.config_value=value,this.runSave(config)},filterConfigurations:function(t){return this.configurations.filter((e,i)=>e.config_type==t)},changeSectionActive:function(t){this.sectionActive=t;var e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?section="+t;window.history.pushState({path:e},"",e)},toggleView:function(){this.tableView=!this.tableView,this.initPlugins()},toggleEddit(t){t.editable=!t.editable,this.$forceUpdate()},resetFilter:function(){this.filter=""},initPlugins:function(){setTimeout(()=>{var t=document.querySelectorAll(".tooltipped");M.Tooltip.init(t,{});t=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(t,{});t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{});t=document.querySelectorAll("select");M.FormSelect.init(t,{})},3e3)},saveConfig(t){if(this.toggleEddit(t),"boolean"!=t.config_data){let e=new VueForm({field:{value:t.config_value,required:!0,type:t.config_data.validate_as,maxLength:t.config_data.max_lenght,minLength:t.config_data.min_lenght}});e.validate(),e.errors.length>0?(t.validate=!1,M.toast({html:"Verificar la configuracion del campo"})):(t.validate=!0,this.runSave(t))}else this.runSave(t)},runSave(t){var e=this,i=BASEURL+"api/v1/config";$.ajax({type:"POST",url:i,data:t,dataType:"json",success:function(t){e.debug&&console.log(i,t),200==t.code?("function"==typeof callBack&&callBack(t),M.toast({html:"Config Saved!"})):M.toast({html:t.responseJSON.error_message})},error:function(t){M.toast({html:t.responseJSON.error_message})}})},getconfigurations:function(){var t=this,e=BASEURL+"api/v1/config/";fetch(e).then(t=>t.json()).then(e=>{let i=e.data;for(const t in i)if(i.hasOwnProperty(t)){i[t].user=new User(i[t].user);try{i[t].config_data=JSON.parse(i[t].config_data)}catch(e){i[t].config_data={}}}t.configurations=i,t.loader=!1}).catch(e=>{M.toast({html:e.responseJSON.error_message}),t.loader=!1})},deleteConfiguration:function(t,e){var i=this;i.loader=!0,$.ajax({type:"DELETE",url:BASEURL+"api/v1/configuration/"+t.configuration_id,data:{},dataType:"json",success:function(t){200==t.code&&i.configurations.splice(e,1)},error:function(t){M.toast({html:response.responseJSON.error_message}),i.loader=!1}})},base_url:function(t){return BASEURL+t}},mounted:function(){this.$nextTick((function(){this.getconfigurations(),window.addEventListener("popstate",t=>{try{var e=location.search.substring(1);(e=JSON.parse('{"'+e.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(t,e){return""===t?e:decodeURIComponent(e)}))).section&&this.routes.includes(e.section)?this.sectionActive=e.section:this.sectionActive="home"}catch(t){this.sectionActive="home"}},!1);try{var t=location.search.substring(1);(t=JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(t,e){return""===t?e:decodeURIComponent(e)}))).section&&this.routes.includes(t.section)&&(this.sectionActive=t.section)}catch(t){this.sectionActive="home"}}))}});