Vue.component("albumesWidget",{template:"#albumes-widget-template",props:["albumes"],data:function(){return{debug:DEBUGMODE}},mixins:[mixins],methods:{getPageImagePath(e,t){let a=e.items[t]?e.items[t]:{file:{}};return a.file.file_front_path?BASEURL+a.file.file_front_path:BASEURL+"public/img/default.jpg"}},mounted:function(){this.$nextTick((function(){}))}}),Vue.component("createContents",{template:"#create-contents-template",props:["forms_types","content"],data:function(){return{debug:DEBUGMODE}},mixins:[mixins],methods:{isActive:e=>e.status,toggleStatus(e){$.ajax({type:"POST",url:BASEURL+"api/v1/forms/data_set_status/"+e.form_content_id,data:{status:e.status?"1":"0"},dataType:"json",success:function(e){console.log(e),M.toast({html:"Actualizado"})}})},getFormsTypeUrl:e=>BASEURL+"admin/formularios/addData/"+e.form_custom_id,base_url:e=>BASEURL+e},mounted:function(){this.$nextTick((function(){this.debug&&console.log("mounted: createContents")}))}}),Vue.component("fileExplorerCollection",{template:"#fileExplorerCollection-template",props:["files"],data:function(){return{debug:DEBUGMODE}},mixins:[mixins],computed:{shortFiles:function(){if(this.filter){let e=this.filter.toLowerCase();return this.files.filter((t,a)=>this.searchInObject(t,e))}return this.files.filter(e=>"folder"!=e.file_type).slice(0,25)}},methods:{getFiles(){var e=this;$.ajax({type:"GET",url:BASEURL+"api/v1/files/",data:{},dataType:"json",success:function(t){if(200==t.code){let a=t.data;a=a.map(e=>new ExplorerFile(e)),e.files=a,e.init()}}})},getFilterFiles(e,t){var a=this;$.ajax({type:"GET",url:BASEURL+"api/v1/files/filter_files",data:{filter_name:e,filter_value:t},dataType:"json",success:function(e){if(200==e.code){let t=e.data.map(e=>new ExplorerFile(e));a.files=t}}})},filterFiles(e){switch(e){case"important":this.getFilterFiles("featured",["1"]);break;case"trash":this.getFilterFiles("file_path",["./trash/"]),this.curDir="./trash/";break;case"images":this.getFilterFiles("file_type",["jpg","png","gif"]);break;case"doc":this.getFilterFiles("file_type",["pdf","doc"]);break;case"docs":this.getFilterFiles("file_type",["pdf","doc","xls"]);break;case"audio":this.getFilterFiles("file_type",["acc, mp3"]);break;case"video":this.getFilterFiles("file_type",["mp4"]);break;case"zip":this.getFilterFiles("file_type",["zip","rar"])}},featuredFileServe(e){e.featured="1"==e.featured?"0":"1",$.ajax({type:"POST",url:BASEURL+"api/v1/files/featured_file",data:{file:e},dataType:"json",success:function(e){200==e.code&&M.toast({html:"Done!"})}})},init(){setTimeout(()=>{var e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{})},2e3)}},mounted:function(){this.$nextTick((function(){this.init(),this.debug&&console.log("mounted: fileExplorerCollection")}))}}),Vue.component("pageCard",{template:"#page-card-template",props:["pages"],data:function(){return{debug:DEBUGMODE}},methods:{contentText:function(e){var t=document.createElement("span");return t.innerHTML=e.content,(t.textContent||t.innerText).substring(0,220)+"..."},getPageFullPath:function(e){if(1==e.status)return BASEURL+e.path},getPageEditPath:function(e){return BASEURL+"admin/paginas/editar/"+e.page_id}},mounted:function(){this.$nextTick((function(){}))}}),Vue.component("usersCollection",{template:"#user-collection-template",props:["users"],data:function(){return{debug:DEBUGMODE}},methods:{},mounted:function(){this.$nextTick((function(){this.debug&&console.log("mounted: usersCollection")}))}});var dashboardModule=new Vue({el:"#root",data:{debug:DEBUGMODE,loader:!0,users:[],files:[],pages:[],forms_types:[],albumes:[],content:[],api_data:{dashboard:BASEURL+"api/v1/dashboard/"},graphs:{devices:{porcentajeMayor:"",labelMayor:""},urlFrecuentes:{porcentajeMayor:"",labelMayor:"",valorMasAlto:""}},timeline:[],creator:{modes:["page","album","categorie","fragment"],icons:{page:"web",album:"perm_media",categorie:"receipt",fragment:"bookmark_border"},content:"",mode:"page"}},mixins:[mixins],computed:{pages_draf:function(){return this.pages.filter(e=>"2"==e.status).slice(0,5).map(e=>({...e,link:`${BASEURL}admin/paginas/editar/${e.page_id}`}))}},methods:{setCreatorMode:function(e){this.creator.mode=e},string_to_slug:function(e){if(0==e.length)return"";e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var t="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",a=0,i=t.length;a<i;a++)e=e.replace(new RegExp(t.charAt(a),"g"),"aaaaeeeeiiiioooouuuunc-/----".charAt(a));return e=e.replace(/[^a-z0-9 -/]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},getCreatorBasicData:function(){const e=this.creator.content,t=e.substring(0,40);return{content:e,title:t,path:this.string_to_slug(t),currentUser:new User(JSON.parse(localStorage.getItem("userdata")))}},getPageObject:function(){let{content:e,title:t,path:a,currentUser:i}=this.getCreatorBasicData();return{content:e,title:t,path:a,subtitle:"",page_type_id:1,status:2,json_content:[],publishondate:!0,date_publish:null,visibility:1,template:"default",layout:"default",categorie_id:0,subcategorie_id:0,mainImage:"",thumbnailImage:"",page_data:{title:t,meta:[{name:"author",content:i.get_fullname()},{name:"keywords",content:t},{name:"description",content:e},{name:"ROBOTS",content:"NOODP"},{name:"GOOGLEBOT",content:"INDEX, FOLLOW"},{property:"og:title",content:t},{property:"og:description",content:"Content of the page"},{property:"og:site_name",content:i.get_fullname()},{property:"og:url",content:""},{property:"og:image",content:""},{property:"og:type",content:"article"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:site",content:""},{name:"twitter:creator",content:""},{name:"twitter:site",content:""},{name:"twitter:title",content:t},{name:"twitter:description",content:e},{name:"twitter:image",content:""}]}}},getAlbumObject:function(){let{content:e,title:t}=this.getCreatorBasicData();return{name:t,description:e,status:2,album_items:[]}},getCategorieObject:function(){let{content:e,title:t}=this.getCreatorBasicData();return{name:t,description:e,type:"page",parent_id:0,status:2}},getFragmentsObjects:function(){let{content:e,title:t}=this.getCreatorBasicData();return{name:t,description:e,type:"parrafo",parent_id:0,status:2}},saveDraft:function(){if(this.creator.content.length<6)return;let e={},t="";switch(this.creator.mode){case"page":e=this.getPageObject(),t=BASEURL+"api/v1/pages/";break;case"album":e=this.getAlbumObject(),t=BASEURL+"api/v1/albumes/";break;case"categorie":e=this.getCategorieObject(),t=BASEURL+"api/v1/categorie/";break;case"fragment":e=this.getFragmentsObjects(),t=BASEURL+"api/v1/fragments/"}var a=this;$.ajax({type:"POST",url:t,data:e,dataType:"json",success:e=>{if(a.debug&&console.log(t,e),200==e.code)switch(this.creator.mode){case"page":window.location.href=`${BASEURL}admin/paginas/editar/${e.data.page_id}`;break;case"album":window.location.href=`${BASEURL}admin/galeria/editar/${e.data.album_id}`;break;case"categorie":window.location.href=`${BASEURL}admin/categorias/editar/${e.data.categorie_id}`;break;case"fragment":window.location.href=`${BASEURL}admin/Fragments/editar/${e.data.fragment_id}`}},error:function(e){a.loader=!1,M.toast({html:"Ocurrió un error inesperado"}),console.error(error)}})},init(){setTimeout(()=>{var e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{});e=document.querySelectorAll(".collapsible");M.Collapsible.init(e,{})},3e3)},createChart:(e,t)=>{const a=document.getElementById(e);new Chart(a,{type:t.type,data:t.data,options:{plugins:{legend:{display:!1}},scales:{x:{display:t.displayX||!1,grid:{display:t.displayGrid||!1}},y:{display:t.displayY||!1,grid:{display:t.displayGrid||!1}}}}})},calcularPorcentajeMayor:function(e){const{labels:t,datasets:a}=e,i=a[0].data,r=i.reduce((e,t)=>e+t,0),n=Math.max(...i),s=i.indexOf(n);return{porcentajeMayor:(n/r*100).toFixed(0),labelMayor:t[s],valorMasAlto:i[s]}},getTimeLine:function(e){return e.map(e=>{if(e.page_id)return{title:e.title,content:this.getcontentText(e.content),link:`${BASEURL}admin/paginas/view/${e.page_id}`,user:new User(e.user),date:this.timeAgo(e.date_create),imagen_file:e.imagen_file?e.imagen_file:null,status:e.status}}).filter(e=>e&&"1"==e.status)},getDashboardData(){fetch(this.api_data.dashboard).then(e=>e.json()).then(e=>{let t=e.data;this.users=t.users?t.users.map(e=>new User(e)):[],this.pages=t.pages?t.pages.map(e=>(e.user=new User(e.user),e)):[],this.forms_types=t.forms_types?t.forms_types:[],this.content=t.content?t.content.map(e=>(e.user=new User(e.user),e.status="1"==e.status,e)):[],this.files=t.files?t.files.map(e=>new ExplorerFile(e)):[],this.albumes=t.albumes?t.albumes.map(e=>(e.user=new User(e.user),e)):[],this.loader=!1,this.graphs.devices=this.calcularPorcentajeMayor(t.chart3),this.graphs.urlFrecuentes=this.calcularPorcentajeMayor(t.chart4),this.timeline=this.getTimeLine(t.timeline),this.createChart("myChart1",{type:"line",data:t.chart1,displayGrid:!1}),this.createChart("myChart2",{type:"bar",data:t.chart2,displayGrid:!1}),this.createChart("myChart3",{type:"bar",data:t.chart3,displayX:!1,displayY:!1}),this.createChart("myChart4",{type:"doughnut",data:t.chart4,displayX:!1,displayY:!1}),this.init()}).catch(e=>{console.error(e)})}},mounted:function(){this.$nextTick(()=>{this.getDashboardData()})}});