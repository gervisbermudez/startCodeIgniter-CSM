Vue.component("createContents", {
  template: "#create-contents-template",
  props: [],
  data: function () {
    return {
      debug: false,
      loader: false,
      forms_types: [],
      content: [],
    };
  },
  methods: {
    getDataFromServe() {
      var self = this;
      $.ajax({
        type: "GET",
        url: BASEURL + "api/v1/forms/",
        data: {},
        dataType: "json",
        success: function (response) {
          console.log(response);
          self.forms_types = response.data;
        },
      });

      $.ajax({
        type: "GET",
        url: BASEURL + "api/v1/forms/data",
        data: {},
        dataType: "json",
        success: function (response) {
          console.log(response);
          self.content = response.data;
        },
      });

      setTimeout(() => {
        var elems = document.querySelectorAll(".dropdown-trigger");
        var instances = M.Dropdown.init(elems, {});
        var elems = document.querySelectorAll(".collapsible");
        var instances = M.Collapsible.init(elems, {});
      }, 3000);
    },
    getFormsTypeUrl(formObject) {
      return BASEURL + "admin/formularios/addData/" + formObject.form_custom_id;
    },
    base_url(path) {
      return BASEURL + path;
    },
  },
  mounted: function () {
    this.$nextTick(function () {
      this.debug ? console.log("mounted: createContents") : null;
      this.getDataFromServe();
    });
  },
});

Vue.component("fileExplorerCollection", {
  template: "#fileExplorerCollection-template",
  data: function () {
    return {
      debug: DEBUGMODE,
      files: [],
    };
  },
  methods: {
    getFeaturedFiles() {
      var self = this;
      $.ajax({
        type: "POST",
        url: BASEURL + "admin/archivos/ajax_get_filter_files",
        data: {
          filter_name: "featured",
          filter_value: "1",
        },
        dataType: "json",
        success: function (response) {
          if (response.code == 200) {
            let data = response.data;
            data = data.map((file) => {
              return new ExplorerFile(file);
            });
            self.files = data;
          }
        },
      });
    },
    featuredFileServe(file) {
      var self = this;
      file.featured = 0;
      $.ajax({
        type: "POST",
        url: BASEURL + "admin/archivos/ajax_featured_file",
        data: {
          file: file,
        },
        dataType: "json",
        success: function (response) {
          if (response.code == 200) {
            M.toast({ html: "Done!" });
            self.getFeaturedFiles();
          }
        },
      });
    },
  },
  mounted: function () {
    this.$nextTick(function () {
      this.getFeaturedFiles();
      this.debug ? console.log("mounted: usersCollection") : null;
    });
  },
});

Vue.component("pageCard", {
  template: "#page-card-template",
  data: function () {
    return {
      debug: DEBUGMODE,
      pages: [],
    };
  },
  computed: {
    /*filterPages: function () {
       if (this.pages.length > 3) {
        return this.pages.slice(0, 3);
      } 
      return this.pages;
    },*/
  },
  methods: {
    contentText: function (page) {
      var span = document.createElement("span");
      span.innerHTML = page.content;
      let text = span.textContent || span.innerText;
      return text.substring(0, 220) + "...";
    },
    getPages: function () {
      var self = this;
      $.ajax({
        type: "GET",
        url: BASEURL + "api/v1/pages/",
        data: {},
        dataType: "json",
        success: function (response) {
          let pages = response.data;
          self.pages = pages.map((page) => {
            page.user = new User(page.user);
            return page;
          });
        },
        error: function (error) {
          console.error(error);
        },
      });
    },
    getPageFullPath: function (page) {
      if (page.status == 1) {
        return BASEURL + page.path;
      }
      return BASEURL + "admin/paginas/editar/" + page.page_id;
    },
  },
  mounted: function () {
    this.$nextTick(function () {
      this.getPages();
    });
  },
});

Vue.component("usersCollection", {
  template: "#user-collection-template",
  data: function () {
    return {
      debug: DEBUGMODE,
      users: [],
    };
  },
  methods: {
    getUsers() {
      var self = this;
      $.ajax({
        type: "GET",
        url: BASEURL + "api/v1/users/",
        data: {},
        dataType: "json",
        success: function (response) {
          this.debug ? console.log(response) : null;
          let users = response.data;
          self.users = users.map((user) => new User(user));
        },
        error: function (error) {
          console.error(error);
        },
      });
    },
  },
  mounted: function () {
    this.$nextTick(function () {
      this.getUsers();
      this.debug ? console.log("mounted: usersCollection") : null;
    });
  },
});

var dashboardModule = new Vue({
  el: "#root",
  data: {
    debug: DEBUGMODE,
    loader: true,
  },
  mounted: function () {
    this.$nextTick(function () {
      setTimeout(() => {
        M.AutoInit();
        this.loader = false;
      }, 3000);
    });
  },
});
