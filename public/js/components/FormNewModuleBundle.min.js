Vue.component("formFieldTextArea",{template:"#formFieldTextArea-template",props:["tab-parent","field-ref","field-ref-index","serveData","configurable","fieldData"],data:function(){return{form_field_id:null,fieldID:this.makeid(10),fieldName:"",fielApiID:"",text:null,form_custom_data_id:null,fieldPlaceholder:""}},methods:{convertfielApiID(){this.fielApiID=this.fieldName.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,"")},makeid(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=i.length,s=0;s<t;s++)e+=i.charAt(Math.floor(Math.random()*a));return e},getData(){return{fieldID:this.fieldID,fieldName:this.fieldName,fielApiID:this.fielApiID,form_custom_data_id:this.form_custom_data_id}},getContentData(){return{text:this.text}}},mounted:function(){this.$nextTick((function(){for(const t in this.serveData)if(this.serveData.hasOwnProperty(t)){const e=this.serveData[t];this[t]=e}this.fieldData&&(this.form_field_id=this.fieldData.form_field_id,this.form_custom_data_id=this.fieldData.form_custom_data_id,this.text=this.fieldData.form_value.text)}))}}),Vue.component("formFieldTitle",{template:"#formFieldTitle-template",props:["tab-parent","field-ref","field-ref-index","serveData","configurable","fieldData"],data:function(){return{fieldPlaceholder:"",form_field_id:null,fieldID:this.makeid(10),fieldName:"",fielApiID:"",title:null,form_custom_data_id:null}},methods:{convertfielApiID(){this.fielApiID=this.fieldName.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""),this.fieldPlaceholder=this.fieldName.toLowerCase()},makeid(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=i.length,s=0;s<t;s++)e+=i.charAt(Math.floor(Math.random()*a));return e},getData(){return{fieldPlaceholder:this.fieldPlaceholder,fieldID:this.fieldID,fieldName:this.fieldName,fielApiID:this.fielApiID,form_custom_data_id:this.form_custom_data_id}},getContentData(){return{title:this.title}}},mounted:function(){this.$nextTick((function(){for(const t in this.serveData)if(this.serveData.hasOwnProperty(t)){const e=this.serveData[t];this[t]=e}this.fieldData&&(this.form_field_id=this.fieldData.form_field_id,this.form_custom_data_id=this.fieldData.form_custom_data_id,this.title=this.fieldData.form_value.title)}))}}),Vue.component("formTextFormat",{template:"#formTextFormat-template",props:["tab-parent","field-ref","field-ref-index","serveData","configurable","fieldData"],data:function(){return{form_field_id:null,fieldID:"text_format_"+this.makeid(10),fieldName:"text_format",fielApiID:"text_format_"+this.makeid(4),text:null,form_custom_data_id:null,fieldPlaceholder:""}},methods:{makeid(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=i.length,s=0;s<t;s++)e+=i.charAt(Math.floor(Math.random()*a));return e},convertfielApiID(){this.fielApiID=this.fieldName.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,"")},getData(){return{fieldID:this.fieldID,fieldName:this.fieldName,fielApiID:this.fielApiID,form_custom_data_id:this.form_custom_data_id}},getContentData(){return{text:this.text}},init(){tinymce.init({selector:"#"+this.fieldID,plugins:["link table code"],setup:t=>{t.on("Change",t=>{this.text=tinymce.editors[this.fieldID].getContent()})}})}},mounted:function(){this.$nextTick((function(){for(const t in this.serveData)if(this.serveData.hasOwnProperty(t)){const e=this.serveData[t];this[t]=e}this.fieldData&&(this.form_field_id=this.fieldData.form_field_id,this.form_custom_data_id=this.fieldData.form_custom_data_id,this.text=this.fieldData.form_value.text),this.init()}))}});var FormNewModule=new Vue({el:"#root",data:{debug:DEBUGMODE,editMode:!1,loader:!0,form_name:"Nuevo Formulario",form_description:"",date_create:null,date_update:null,user:{},status:!0,tabs:[],form_custom_id:null,formsElements:[{field_name:"title",displayName:"Titulo",icon:"format_color_text",component:"formFieldTitle",status:"1",data:{}},{field_name:"text",displayName:"Texto",icon:"short_text",component:"formFieldTextArea",status:"1",data:{}},{field_name:"formatText",displayName:"Texto con formato",component:"formTextFormat",icon:"format_size",status:"1",data:{}},{field_name:"image",displayName:"Imagen",icon:"image",status:"1",data:{}},{field_name:"date",displayName:"Fecha",icon:"date_range",status:"1",data:{}},{field_name:"timestamp",displayName:"Fecha y Hora",icon:"access_time",status:"1",data:{}},{field_name:"number",displayName:"Numero",icon:"looks_one",status:"1",data:{}},{field_name:"dropdown_select",displayName:"Select",status:"1",icon:"list",data:{}},{field_name:"bolean",displayName:"Bolean",status:"1",icon:"check_circle",data:{}}],configurable:!0},methods:{getInitialTab(){return{tab_name:"Tab "+(this.tabs.length+1),tabID:this.makeid(10),form_tab_id:null,form_fields:[],edited:!0,active:!0,status:!0}},setActive(t){this.tabs.map(t=>(t.active=!1,t)),this.tabs[t].active=!0},addTab(){this.debug&&console.log("addTab trigger"),this.tabs.push(this.getInitialTab()),this.setActive(this.tabs.length-1)},saveTab(t){this.debug&&console.log("saveTab trigger"),this.tabs[t].edited=!1},makeid(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=i.length,s=0;s<t;s++)e+=i.charAt(Math.floor(Math.random()*a));return e},deleteTab(t){if(this.debug&&console.log("deleteTab trigger"),1==this.tabs.length)return!1;this.tabs.splice(t,1)},getActiveTab(){let t;return this.tabs.forEach((e,i)=>{e.active&&(t=i)}),t},addField(t){this.debug&&console.log("addField trigger"),this.tabs[this.getActiveTab()].form_fields.push(JSON.parse(JSON.stringify(t))),setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{});t=document.querySelectorAll(".tooltipped"),M.Tooltip.init(t,{});M.AutoInit()},2e3)},removeField(t,e){"formTextFormat"==this.tabs[t].form_fields[e].component?(this.getfieldsData(),editor=this.tabs[t].form_fields[e].data,tinymce.editors[editor.fieldID].destroy(),this.tabs[t].form_fields.splice(e,1)):this.tabs[t].form_fields.splice(e,1)},getfieldsData(){this.debug&&console.log("getfieldsData trigger"),fieldsComponents=FormNewModule.$refs;for(const t in fieldsComponents)if(fieldsComponents.hasOwnProperty(t)){const e=fieldsComponents[t];for(let t=0;t<e.length;t++){const i=e[t];FormNewModule.setFieldData(i.tabParent.tabID,i.fieldRefIndex,JSON.parse(JSON.stringify(i.getData())))}}},setFieldData(t,e,i){this.debug&&console.log("setFieldData trigger"),this.tabs.map(a=>{a.tabID==t&&(a.form_fields[e].data=i)})},getFormData(){return this.getfieldsData(),{form_custom_id:this.form_custom_id,form_name:this.form_name,form_description:this.form_description,date_create:this.date_create,date_update:this.date_update,status:this.status?1:0,user:this.user,tabs:this.tabs}},saveData(){$("html, body").animate({scrollTop:0},600),this.loader=!0,this.debug&&console.log("saveData trigger");var t=this.getFormData(),e=BASEURL+"api/v1/forms",i=this;$.ajax({type:"POST",url:e,data:{data:JSON.stringify(t)},dataType:"json",success:function(t){i.debug&&console.log(e,t),t.data&&(i.form_custom_id=t.data.form_custom_id,i.editMode=!0,i.loader=!1,M.toast({html:"Formulario Guardado"}))},error:function(t){i.loader=!1,M.toast({html:t.responseJSON.error_message})}})},checkEditMode(){if("undefined"!=typeof form_custom_id){this.editMode=!0,this.form_custom_id=form_custom_id,console.log("editMode",this.editMode);var t=this,e=BASEURL+"api/v1/forms/"+form_custom_id;$.ajax({type:"GET",url:e,data:{},dataType:"json",success:function(i){t.debug&&console.log(e,i),"200"==i.code&&t.updateFormData(i.data)},error:function(e){t.loader=!1,M.toast({html:"OcurriÃ³ un error"})}})}else this.loader=!1},updateFormData(t){this.serverdata=t,this.form_name=t.form_name,this.form_description=t.form_description,this.date_create=t.date_create,this.date_update=t.date_update,this.status="1"==t.status,this.user=t.user,this.tabs=t.tabs.map((t,e)=>({edited:!1,active:!1,tab_name:t.tab_name,status:"1"==t.status,form_tab_id:t.form_tab_id,form_fields:t.form_fields?t.form_fields:[],tabID:this.makeid(10)})),this.tabs[0].active=!0,setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{}),this.loader=!1},2e3)}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("FormNewModule mounted"),this.tabs.push(this.getInitialTab()),this.tabs[0].edited=!1,this.checkEditMode()}))}});