Vue.component("FileExplorerSelector",{template:"#file-explorar-selector",props:["mode","multiple","filter","modal","ignore","preselected","uploader","initialdir"],data:function(){return{debug:DEBUGMODE,title:"Seleccionar",selectedRoot:!1,root:"./",curDir:"",fileloader:!1,files:[],backto:null,search:"",create_folder_process:!1,new_folder_name:"new folder"}},mixins:[mixins],watch:{initialdir:function(e){this.curDir=e}},computed:{selected(){return this.files,this.files.filter(e=>1==e.selected)},getFolders(){return this.files.filter(e=>("./"!=e.file_path||"trash"!=e.file_name)&&(this.preselected.forEach(t=>{e.file_id==t.file_id&&(e.selected=!0)}),"folder"==e.file_type))},getFiles(){return this.files.filter(e=>(this.preselected.forEach(t=>{e.file_id==t.file_id&&(e.selected=!0)}),"folder"!=e.file_type))},getBackPath(){return this.getbreadcrumb.length>0?this.getbreadcrumb[this.getbreadcrumb.length-1].path:this.root},getbreadcrumb(){let e=this.curDir.split("/").filter(e=>""!=e&&"."!=e);return e=e.map((t,i)=>{let s=[];for(let t=0;t<i;t++)s.push(e[t]);let a=s.join("/");return a?{path:this.root+a+"/",folder:t}:{path:this.root+a,folder:t}}),e}},methods:{makeNewFolder(){this.create_folder_process=!0,setTimeout(()=>{$("#folder_name").focus(),$("#folder_name").select()},1e3)},makeFolderServer(){var e=this;$.ajax({type:"POST",url:BASEURL+"api/v1/files/make_dir",data:{path:e.curDir,new_folder_name:$("#folder_name").val()},dataType:"json",success:function(t){console.log(t),e.create_folder_process=!1,e.navigateFiles(e.curDir)}})},showCheckbox(e){return"folders"==this.mode&&!this.multiple&&this.selected.length>0&&e.file_id!=this.selected[0].file_id||"folders"==this.mode&&!this.multiple&&this.selected.length>0&&(e.file_id,this.selected[0].file_id),!(!this.multiple&&0!=this.selected.length)||e.file_id==this.selected[0].file_id},getSelected(){return this.selected},getSelectedRoot:()=>({is_root:!0,file_id:"0",rand_key:"",file_name:"",file_path:"./",file_type:"",parent_name:"./",user_id:"",shared_user_group_id:"",share_link:"",featured:"",date_create:"",date_update:"",status:"",selected:!0}),onClickButton(e){this.$emit("notify",this.selectedRoot?[this.getSelectedRoot()]:this.getSelected())},getFullFileName:e=>e.file_name+"."+e.file_type,getFullFilePath(e){return BASEURL+e.file_path+this.getFullFileName(e)},getIcon(e){let t="far fa-file";switch(e.file_type){case"folder":t="far fa-folder";break;case"jpg":case"jpeg":case"png":case"gif":t="fas fa-file-image";break;case"html":t="fab fa-html5";break;case"scss":t="fab fa-sass";break;case"css":case"min.css":t="fab fa-css3-alt";break;case"txt":t="far fa-file-alt";break;case"php":case"blade.php":t="fab fa-php";break;case"js":case"json":case"min.js":t="fab fa-js";break;case"eot":case"otf":case"woff2":t="fas fa-font"}return t},getExtention:e=>"folder"==e.file_type?"":"."+e.file_type,isImage:e=>"jpg"==e.file_type||"jpeg"==e.file_type||"png"==e.file_type||"gif"==e.file_type,getImagePath(e){if(this.isImage(e))return BASEURL+e.file_path.substr(2)+e.file_name+"."+e.file_type},toggleView(){},navigateFiles(e){var t=this;t.backto=t.getBackPath,t.curDir=e,e==t.root&&(t.backto=null),t.fileloader=!0;var i={path:e};$.ajax({type:"GET",url:BASEURL+"api/v1/files/",data:i,dataType:"json",success:function(e){t.fileloader=!1,200==e.code&&e.data.length?t.files=e.data:t.files=[],t.init()}})},filterFiles(e){switch(e){case"important":this.getFilterFiles("featured",["1"]);break;case"trash":this.getFilterFiles("file_path",["./trash/"]),this.curDir="./trash/";break;case"images":this.getFilterFiles("file_type",["jpg","png","gif"]);break;case"doc":this.getFilterFiles("file_type",["pdf","doc"]);break;case"docs":this.getFilterFiles("file_type",["pdf","doc","xls"]);break;case"audio":this.getFilterFiles("file_type",["acc, mp3"]);break;case"video":this.getFilterFiles("file_type",["mp4"]);break;case"zip":this.getFilterFiles("file_type",["zip","rar"])}},resetSearch(){this.search=null;this.filter?this.filterFiles(this.filter):this.navigateFiles(this.root)},searchfiles(){this.search?this.getFilterFiles("file_name",[this.search]):this.navigateFiles(this.root)},getFilterFiles(e,t){var i=this;$.ajax({type:"POST",url:BASEURL+"api/v1/files/filter_files",data:{filter_name:e,filter_value:t},dataType:"json",success:function(e){200==e.code&&(i.files=e.data,i.init())}})},init(){setTimeout(()=>{var e=document.querySelectorAll(".materialboxed");M.Materialbox.init(e,{}),M.Tabs.init(document.getElementById("selectorTabs"),{})},3e3)},initUploader(){$("#input-100").fileinput({uploadUrl:BASEURL+"admin/archivos/ajax_upload_file",enableResumableUpload:!0,resumableUploadOptions:{},uploadExtraData:{uploadToken:"SOME-TOKEN",curDir:this.curDir||"./uploads/"},showCancel:!0,initialPreview:[],fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!1,showDrag:!0,removeIcon:'<i class="fas fa-trash"></i>',removeClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="fas fa-upload"></i>',uploadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="fas fa-download"></i>',downloadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="fas fa-search-plus"></i>',zoomClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="fas fa-arrows-alt"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorPaused:'<i class="glyphicon glyphicon-pause text-primary"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ...",indicatorPausedTitle:"Upload Paused"},uploadIcon:'<i class="fas fa-upload"></i>',removeIcon:'<i class="fas fa-trash"></i>',overwriteInitial:!1,deleteUrl:"http://localhost/file-delete.php",progressClass:"determinate progress-bar bg-success progress-bar-success progress-bar-striped active",progressInfoClass:"determinate progress-bar bg-info progress-bar-info progress-bar-striped active",progressCompleteClass:"determinate progress-bar bg-success progress-bar-success",progressPauseClass:"determinate progress-bar bg-primary progress-bar-primary progress-bar-striped active",progressErrorClass:"determinate progress-bar bg-danger progress-bar-danger"}).on("fileuploaded",(e,t,i,s)=>{M.Tabs.init(document.getElementById("selectorTabs"),{}).select("selector"),this.updateSelector()})},destroyFileinputInstance(){$("#input-100").fileinput("destroy")},updateSelector(){this.preselected||(this.preselected=[]),this.filter&&"files"==this.mode?this.filterFiles(this.filter):this.navigateFiles(this.root),this.init()}},filters:{shortName:function(e){return e?(e=e.toString()).length>15?e.substr(0,15)+"...":e.substr(0,15):""}},mounted:function(){this.$nextTick((function(){this.updateSelector()}))}});