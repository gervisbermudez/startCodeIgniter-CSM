var FragmentNewForm=new Vue({el:"#root",data:{debug:DEBUGMODE,loader:!0,editMode:!1,fragment_id:null,form:new VueForm({name:{value:null,required:!0,type:"username",maxLength:120,minLength:1,customPattern:/[a-zA-Z0-9,#.-\s]+/}}),description:"",status:!1,date_publish:"",date_create:"",date_update:"",type:"contenido",fragment_types:["contenido","parrafo","widget","page","formulario","video","foto","evento"],user_id:null,user:null},computed:{btnEnable:function(){let e=!!this.form.fields.name.value||!1;return e}},filters:{capitalize:function(e){return e?(e=e.toString()).charAt(0).toUpperCase()+e.slice(1):""}},methods:{autoSave(){this.status||(this.runSaveData(),this.debug&&console.log("running autosave..."))},validateField(e){let t=UserNewForm;if(!t.form.validateField(e))return t.form.fields[e].valid;t.serverValidation(e)},validateForm(){this.form.validate();return 0==this.form.errors.length&&!0},save(){this.validateForm()?(this.loader=!0,this.runSaveData(e=>{M.toast({html:"<span>Categorie saved </span>"})})):M.toast({html:"Verifique todos los campos del formulario"})},runSaveData(e){var t=this,a=BASEURL+"api/v1/fragments/";$.ajax({type:"POST",url:a,data:t.getData(),dataType:"json",success:function(i){t.debug&&console.log(a,i),setTimeout(()=>{t.loader=!1},1500),200==i.code?(t.editMode=!0,t.fragment_id=i.data.fragment_id,"function"==typeof e&&e(i)):(M.toast({html:i.responseJSON.error_message}),t.loader=!1)},error:function(e){M.toast({html:e.responseJSON.error_message}),t.loader=!1}})},getData:function(){return{fragment_id:this.fragment_id||"",name:this.form.fields.name.value||"",description:this.description||"",type:this.type||"",parent_id:this.parent_id||0,status:this.status?1:0,date_publish:this.date_publish,date_create:this.date_create,date_update:this.date_update}},getSelectedCategorie(){return this.categories.filter((e,t)=>this.fragment_id==e.fragment_id)},serverValidation(e){var t=this,a=BASEURL+"admin/usuarios/ajax_check_field";$.ajax({type:"POST",url:a,data:{field:e,value:t.form.fields[e].value},dataType:"json",success:function(i){t.debug&&console.log(a,i),i.code&&(t.form.fields[e].valid=i.data,i.data?t.form.markFieldAsValid(e):t.form.fields[e].errorText="The "+e+" is already registered",t.$forceUpdate())}})},getCategories(){var e=this,t=BASEURL+"api/v1/fragments/type/"+e.type;fetch(t).then(e=>e.json()).then(a=>{e.loader=!1,e.debug&&console.log(t,a),200==a.code&&(e.categories=a.data,this.initSelects())}).catch(t=>{e.debug&&console.log(t),e.loader=!1})},checkEditMode(){var e=this;if(fragment_id&&"edit"==editMode){e.editMode=!0;var t=BASEURL+"api/v1/fragments/"+fragment_id;fetch(t).then(e=>e.json()).then(a=>{e.loader=!1,e.debug&&console.log(t,a),200==a.code&&(e.fragment_id=a.data.fragment_id,e.date_create=a.data.date_create,e.date_publish=a.data.date_publish,e.date_update=a.data.date_update,e.description=a.data.description,e.form.fields.name.value=a.data.name,e.status=a.data.status,e.type=a.data.type,e.user_id=a.data.user_id,e.user=new User(a.data.user),setTimeout(()=>{tinymce.editors.id_cazary.setContent(e.description)},5e3)),setTimeout(()=>{M.updateTextFields()},1e3)}).catch(t=>{M.toast({html:t.responseJSON.error_message}),e.loader=!1})}else e.loader=!1},initSelects(){setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},1e3)},initPlugins(){tinymce.init({selector:"textarea",plugins:["link table code"],setup:e=>{e.on("Change",e=>{this.description=tinymce.editors.id_cazary.getContent()})}})}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("mounted CategoriaNewForm"),this.initPlugins(),this.checkEditMode()}))}});