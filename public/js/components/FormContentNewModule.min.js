var FormNewModule=new Vue({el:"#root",data:{debug:DEBUGMODE,editMode:!1,loader:!0,form_name:"Nuevo Formulario",form_description:"",date_create:null,date_update:null,user:{},status:!0,tabs:[],form_custom_id:null,form_content_id:null,formsElements:[{field_name:"title",displayName:"Titulo",icon:"format_color_text",component:"formFieldTitle",status:"1",data:{}},{field_name:"text",displayName:"Texto",icon:"short_text",component:"formFieldTextArea",status:"1",data:{}},{field_name:"formatText",displayName:"Texto con formato",component:"formTextFormat",icon:"format_size",status:"1",data:{}},{field_name:"image",displayName:"Imagen",icon:"image",status:"1",data:{}},{field_name:"link",displayName:"Link",icon:"insert_link",status:"1",data:{}},{field_name:"date",displayName:"Fecha",icon:"date_range",status:"1",data:{}},{field_name:"timestamp",displayName:"Fecha y Hora",icon:"access_time",status:"1",data:{}},{field_name:"number",displayName:"Numero",icon:"looks_one",status:"1",data:{}},{field_name:"dropdown_select",displayName:"Select",status:"1",icon:"list",data:{}},{field_name:"bolean",displayName:"Bolean",status:"1",icon:"check_circle",data:{}}],configurable:!1},methods:{getInitialTab(){return{tab_name:"Tab "+(this.tabs.length+1),tabID:this.makeid(10),form_tab_id:null,form_fields:[],edited:!0,active:!0,status:!0}},setActive(t){this.tabs.map(t=>(t.active=!1,t)),this.tabs[t].active=!0},addTab(){this.debug&&console.log("addTab trigger"),this.tabs.push(this.getInitialTab()),this.setActive(this.tabs.length-1)},saveTab(t){this.debug&&console.log("saveTab trigger"),this.tabs[t].edited=!1},makeid(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=a.length,o=0;o<t;o++)e+=a.charAt(Math.floor(Math.random()*s));return e},deleteTab(t){if(this.debug&&console.log("deleteTab trigger"),1==this.tabs.length)return!1;this.tabs.splice(t,1)},getActiveTab(){let t;return this.tabs.forEach((e,a)=>{e.active&&(t=a)}),t},addField(t){this.debug&&console.log("addField trigger"),this.tabs[this.getActiveTab()].form_fields.push(JSON.parse(JSON.stringify(t))),setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{})},2e3)},getfieldsData(){this.debug&&console.log("getfieldsData trigger"),fieldsComponents=FormNewModule.$refs;for(const t in fieldsComponents)if(fieldsComponents.hasOwnProperty(t)){const e=fieldsComponents[t];for(let t=0;t<e.length;t++){const a=e[t];FormNewModule.setFieldData(a.tabParent.tabID,a.fieldRefIndex,JSON.parse(JSON.stringify(a.getContentData())))}}},setFieldData(t,e,a){this.debug&&console.log("setFieldData trigger"),this.tabs.map(s=>{s.tabID==t&&(s.form_fields[e].data=a)})},getFormData(){return this.getfieldsData(),{form_custom_id:this.form_custom_id,form_content_id:this.form_content_id,form_name:this.form_name,form_description:this.form_description,date_create:this.date_create,date_update:this.date_update,status:this.status?1:0,user:this.user,tabs:this.tabs}},saveData(){$("html, body").animate({scrollTop:0},600),this.debug&&console.log("saveData trigger");var t=this.getFormData(),e=BASEURL+"api/v1/forms/data";console.log(t),this.loader=!0;var a=this;$.ajax({type:"POST",url:e,data:{data:t},dataType:"json",success:function(t){a.debug&&console.log(e,t),t.data&&(a.form_custom_id=t.data.form_custom_id,a.editMode=!0,a.loader=!1,M.toast({html:"Datos Guardados"}))},error:function(t){a.loader=!1,console.log(t),M.toast({html:"Ocurrió un error"})}})},checkEditMode(){if("undefined"!=typeof form_custom_id){this.editMode=!0,this.form_custom_id=form_custom_id,this.form_content_id=form_content_id||null,console.log("editMode",this.editMode);var t=this;if(form_content_id)var e=BASEURL+"api/v1/forms/data/"+form_content_id;else e=BASEURL+"api/v1/forms/"+form_custom_id;$.ajax({type:"GET",url:e,data:{},dataType:"json",success:function(a){t.debug&&console.log(e,a),"200"==a.code&&(form_content_id?t.updateFormData(a.data[0].form_custom):t.updateFormData(a.data))},error:function(e){t.loader=!1,M.toast({html:"Ocurrió un error"})}})}else this.loader=!1},updateFormData(t){this.serverdata=t,this.form_name=t.form_name,this.form_description=t.form_description,this.date_create=t.date_create,this.date_update=t.date_update,this.status="1"==t.status,this.user=t.user,this.tabs=t.tabs.map((t,e)=>({edited:!1,active:!1,tab_name:t.tab_name,status:"1"==t.status,form_tab_id:t.form_tab_id,form_fields:t.form_fields?t.form_fields:[],tabID:this.makeid(10)})),this.tabs[0].active=!0,setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{}),this.loader=!1},2e3)}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("FormNewModule mounted"),this.tabs.push(this.getInitialTab()),this.tabs[0].edited=!1,this.checkEditMode()}))}});