var FormNewModule=new Vue({el:"#root",data:{debug:DEBUGMODE,editMode:!1,loader:!0,form_name:"Nuevo Formulario",form_description:"",date_create:null,date_update:null,user:{},status:!0,tabs:[],custom_model_id:null,custom_model_content_id:null,formsElements:formsElements,configurable:!1},methods:{getInitialTab(){return{tab_name:"Tab "+(this.tabs.length+1),tabID:this.makeid(10),custom_model_tab_id:null,custom_model_fields:[],edited:!0,active:!0,status:!0}},setActive(t){this.tabs.map(t=>(t.active=!1,t)),this.tabs[t].active=!0},addTab(){this.debug&&console.log("addTab trigger"),this.tabs.push(this.getInitialTab()),this.setActive(this.tabs.length-1)},saveTab(t){this.debug&&console.log("saveTab trigger"),this.tabs[t].edited=!1},makeid(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=o.length,a=0;a<t;a++)e+=o.charAt(Math.floor(Math.random()*s));return e},deleteTab(t){if(this.debug&&console.log("deleteTab trigger"),1==this.tabs.length)return!1;this.tabs.splice(t,1)},getActiveTab(){let t;return this.tabs.forEach((e,o)=>{e.active&&(t=o)}),t},addField(t){this.debug&&console.log("addField trigger"),this.tabs[this.getActiveTab()].custom_model_fields.push(JSON.parse(JSON.stringify(t))),setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{})},2e3)},getfieldsData(){this.debug&&console.log("getfieldsData trigger"),fieldsComponents=FormNewModule.$refs;for(const t in fieldsComponents)if(fieldsComponents.hasOwnProperty(t)){const e=fieldsComponents[t];for(let t=0;t<e.length;t++){const o=e[t];FormNewModule.setFieldData(o.tabParent.tabID,o.fieldRefIndex,JSON.parse(JSON.stringify(o.getContentData())))}}},setFieldData(t,e,o){this.debug&&console.log("setFieldData trigger"),this.tabs.map(s=>{s.tabID==t&&(s.custom_model_fields[e].data=o)})},getFormData(){return this.getfieldsData(),{custom_model_id:this.custom_model_id,custom_model_content_id:this.custom_model_content_id,form_name:this.form_name,form_description:this.form_description,date_create:this.date_create,date_update:this.date_update,status:this.status?1:0,user:this.user,tabs:this.tabs}},saveData(){$("html, body").animate({scrollTop:0},600),this.debug&&console.log("saveData trigger");var t=this.getFormData(),e=BASEURL+"api/v1/models/data";console.log(t),this.loader=!0;var o=this;$.ajax({type:"POST",url:e,data:{data:t},dataType:"json",success:function(t){o.debug&&console.log(e,t),t.data&&(o.custom_model_id=t.data.custom_model_id,o.editMode=!0,o.loader=!1,M.toast({html:"Datos Guardados"}))},error:function(t){o.loader=!1,console.log(t),M.toast({html:"Ocurrió un error"})}})},checkEditMode(){if("undefined"!=typeof custom_model_id){this.editMode=!0,this.custom_model_id=custom_model_id,this.custom_model_content_id=custom_model_content_id||null,console.log("editMode",this.editMode);var t=this;if(custom_model_content_id)var e=BASEURL+"api/v1/models/data/"+custom_model_content_id;else e=BASEURL+"api/v1/models/"+custom_model_id;$.ajax({type:"GET",url:e,data:{},dataType:"json",success:function(o){t.debug&&console.log(e,o),"200"==o.code&&(custom_model_content_id?t.updateFormData(o.data[0].custom_model):t.updateFormData(o.data))},error:function(e){t.loader=!1,M.toast({html:"Ocurrió un error"})}})}else this.loader=!1},updateFormData(t){this.serverdata=t,this.form_name=t.form_name,this.form_description=t.form_description,this.date_create=t.date_create,this.date_update=t.date_update,this.status="1"==t.status,this.user=t.user,this.tabs=t.tabs.map((t,e)=>({edited:!1,active:!1,tab_name:t.tab_name,status:"1"==t.status,custom_model_tab_id:t.custom_model_tab_id,custom_model_fields:t.custom_model_fields?t.custom_model_fields:[],tabID:this.makeid(10)})),this.tabs[0].active=!0,setTimeout(()=>{var t=document.querySelectorAll(".collapsible");M.Collapsible.init(t,{});t=document.querySelectorAll(".modal"),M.Modal.init(t,{});this.loader=!1},2e3)}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("FormNewModule mounted"),this.tabs.push(this.getInitialTab()),this.tabs[0].edited=!1,this.checkEditMode()}))}});