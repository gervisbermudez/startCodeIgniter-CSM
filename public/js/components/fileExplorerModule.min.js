var fileExplorerModule=new Vue({el:"#root",data:{debug:DEBUGMODE,root:"./",curDir:"",loader:!1,fileloader:!1,files:[],recentlyFiles:[],backto:null,search:"",editFile:{},moveToTrash:{},showSideRightBar:!1,sideRightBarSelectedFile:{},fileToMove:{},showFile:{file_name:"",file_type:"",file_content:""}},mixins:[mixins],computed:{getFolders(){return this.files.filter(e=>("./"!=e.file_path||"trash"!=e.file_name)&&"folder"==e.file_type)},getFiles(){return this.files.filter(e=>"folder"!=e.file_type)},getBackPath(){return this.getbreadcrumb.length>0?this.getbreadcrumb[this.getbreadcrumb.length-1].path:this.root},getbreadcrumb(){let e=this.curDir.split("/").filter(e=>""!=e&&"."!=e);return e=e.map((t,i)=>{let a=[];for(let t=0;t<i;t++)a.push(e[t]);let l=a.join("/");return l?{path:this.root+l+"/",folder:t}:{path:this.root+l,folder:t}}),e}},watch:{curDir:function(e){$("#input-100").data("fileinput")&&($("#input-100").data("fileinput").uploadExtraData.curDir=e)}},methods:{getFullFileName:e=>e.file_name+"."+e.file_type,setSelected(e){e.selected=!e.selected},setSideRightBarSelectedFile(e){window.scrollTo(0,0),url=BASEURL+"api/v1/users/"+e.user_id,this.sideRightBarSelectedFile=e,this.showSideRightBar=!0,this.sideRightBarSelectedFile.user=null,this.sideRightBarSelectedFile.user_group=null,this.isImage(e)?(this.showFile=e,this.showFile.file_content=!0,this.showFile.isImagen=!0):this.getFileContent(e),fetch(BASEURL+"api/v1/files/"+e.file_id).then(e=>e.json()).then(e=>{200==e.code&&(this.sideRightBarSelectedFile.history=e.data.history||[],this.sideRightBarSelectedFile.history=this.sideRightBarSelectedFile.history.reverse(),this.sideRightBarSelectedFile.history=this.sideRightBarSelectedFile.history.map(e=>({...e,user:new User(e.user)})))}).catch(e=>{console.error(e)}),fetch(url).then(e=>e.json()).then(e=>{200==e.code&&(this.sideRightBarSelectedFile.user=new User(e.data),this.$forceUpdate()),this.initMT()}).catch(e=>{console.error(e)}),url=BASEURL+"/api/v1/users/usergroups/"+e.shared_user_group_id,fetch(url).then(e=>e.json()).then(e=>{this.sideRightBarSelectedFile.user_group=e.data,this.$forceUpdate()}).catch(e=>{console.error(e)})},getFileHistoryIcon(e){switch(e){case"upload":return"cloud_upload";case"rename":return"edit";case"move":return"content_cut";default:return"folder"}},setCloseSideRightBar(){this.showSideRightBar=!1,this.showFile={file_name:"",file_type:"",file_content:""}},getFullFilePath(e){return BASEURL+e.file_path+this.getFullFileName(e)},async shareFile(e){let t=this.getFullFilePath(e);const i={title:e.file_name,text:"",url:t};try{await navigator.share(i)}catch(e){console.error(e)}},getIcon(e){let t="far fa-file";switch(e.file_type){case"folder":t="far fa-folder";break;case"jpg":case"jpeg":case"png":case"gif":t="fas fa-file-image";break;case"html":t="fab fa-html5";break;case"scss":t="fab fa-sass";break;case"css":case"min.css":t="fab fa-css3-alt";break;case"txt":t="far fa-file-alt";break;case"php":case"blade.php":t="fab fa-php";break;case"js":case"json":case"min.js":t="fab fa-js";break;case"eot":case"otf":case"woff2":t="fas fa-font"}return t},getExtention:e=>"folder"==e.file_type?"":"."+e.file_type,isImage:e=>"jpg"==e.file_type||"jpeg"==e.file_type||"png"==e.file_type||"gif"==e.file_type,renameFile(e){this.editFile=e,this.editFile.new_name=this.editFile.file_name},renameFileServe(){var e=this;$.ajax({type:"POST",url:BASEURL+"api/v1/files/rename_file",data:{file:e.editFile},dataType:"json",success:function(t){if(200==t.code){e.editFile.file_name=e.editFile.new_name,M.toast({html:"Renamed file"});var i=document.querySelectorAll(".modal");M.Modal.init(i,{}).close()}}})},featuredFileServe(e){var t=this;e.featured=1==e.featured?0:1,$.ajax({type:"POST",url:BASEURL+"api/v1/files/featured_file",data:{file:e},dataType:"json",success:function(e){200==e.code&&(M.toast({html:"Done!"}),t.$forceUpdate())}})},setFileToMove(e){this.fileToMove=e},trashFile(e){this.moveToTrash=e},moveCallcack(e){M.Modal.getInstance(document.getElementById("folderSelectorMove")).close(),this.moveFileTo(this.fileToMove,e[0].file_path+(e[0].file_name?e[0].file_name+"/":"")),this.navigateFiles(this.curDir)},copyCallcack(e){M.Modal.getInstance(document.getElementById("folderSelectorCopy")).close(),this.copyFileTo(this.fileToMove,e[0].file_path+(e[0].file_name?e[0].file_name+"/":"")),this.navigateFiles(this.curDir)},deleteFile(e){var t=this;e=e;$.ajax({type:"POST",url:BASEURL+"api/v1/files/delete/"+e.file_id,data:{file:e},dataType:"json",success:function(e){200==e.code&&(html="<span>Done! </span>",M.toast({html:html}),t.navigateFiles("./trash/"))}})},moveFileTo(e,t){var i=this;e=e,t=t;$.ajax({type:"POST",url:BASEURL+"api/v1/files/move_file",data:{file:e,newPath:t},dataType:"json",success:function(a){if(200==a.code){html="<span>Done! </span>",M.toast({html:html});let a=null;i.files.forEach((t,i)=>{t.file_id==e.file_id&&(a=i)}),i.files[a].file_path=t,i.files.splice(a,1)}}})},copyFileTo(e,t){var i=this;e=e,t=t;$.ajax({type:"POST",url:BASEURL+"api/v1/files/copy_file",data:{file:e,newPath:t},dataType:"json",success:function(a){if(200==a.code){html="<span>Done! </span>",M.toast({html:html});let a=null;i.files.forEach((t,i)=>{t.file_id==e.file_id&&(a=i)}),i.files[a].file_path=t}}})},getImagePath(e){if(this.isImage(e))return BASEURL+e.file_path.substr(2)+e.file_name+"."+e.file_type},reloadFileExplorer(){var e=this;e.fileloader=!0,e.files=[];var t=BASEURL+"api/v1/files/reload_file_explorer";$.ajax({type:"POST",url:t,data:{path:e.root},dataType:"json",success:function(t){e.navigateFiles(e.curDir)}})},toggleView(){},navigateFiles(e){var t=this;t.backto=t.getBackPath,t.curDir=e,e==t.root&&(t.backto=null),t.fileloader=!0;var i={path:e},a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?path="+encodeURIComponent(e);window.history.pushState({path:a},"",a),$.ajax({type:"GET",url:BASEURL+"api/v1/files/",data:i,dataType:"json",success:function(e){t.fileloader=!1,200==e.code&&e.data.length?t.files=e.data:t.files=[],t.initMT()}})},filterFiles(e){switch(e){case"important":this.getFilterFiles("featured",["1"]);break;case"trash":this.getFilterFiles("file_path",["./trash/"]),this.curDir="./trash/";break;case"images":this.getFilterFiles("file_type",["jpg","png","gif"]);break;case"doc":this.getFilterFiles("file_type",["pdf","doc"]);break;case"docs":this.getFilterFiles("file_type",["pdf","doc","xls"]);break;case"audio":this.getFilterFiles("file_type",["acc, mp3"]);break;case"video":this.getFilterFiles("file_type",["mp4"]);break;case"zip":this.getFilterFiles("file_type",["zip","rar"])}},resetSearch(){this.search=null,this.navigateFiles(this.root)},searchfiles(){this.search?this.getFilterFiles("file_name",[this.search]):this.navigateFiles(this.root)},getFilterFiles(e,t){var i=this;$.ajax({type:"GET",url:BASEURL+"api/v1/files/filter_files",data:{filter_name:e,filter_value:t},dataType:"json",success:function(e){200==e.code&&(i.files=e.data)}})},getFileContent(e){$.ajax({type:"GET",url:BASEURL+"api/v1/files/get_file_content",data:{file:e},dataType:"json",success:t=>{200==t.code&&(this.showFile=e,this.showFile.file_content=t.file_content,setTimeout(()=>{Prism.highlightAll()},1e3))}})},initMT(){setTimeout(()=>{var e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{});e=document.querySelectorAll(".modal"),M.Modal.init(e,{}),M.Tabs.init(document.getElementById("filetabs"),{})},2e3)}},filters:{shortName:function(e){return e?(e=e.toString()).length>15?e.substr(0,15)+"...":e.substr(0,15):""}},mounted:function(){this.$nextTick((function(){const e=new URLSearchParams(window.location.search),t=Object.fromEntries(e.entries());t.path?this.navigateFiles(t.path):this.navigateFiles(this.root)}))}});