var ConfigNewForm=new Vue({el:"#root",data:{debug:DEBUGMODE,loader:!0,editMode:!1,site_config_id:null,user_id:null,user:null,form:new VueForm({config_name:{value:null,required:!0,type:"username",maxLength:120,minLength:1,customPattern:/[a-zA-Z0-9,#.-\s]+/}}),config_description:"",config_value:"",config_label:"",status:!1,date_publish:"",date_create:"",date_update:"",type:"general",parent_id:"0",site_configs:[],parent:null,subsite_configs:[],config_type:"general",config_type_options:["general","analytics","logger","pixel","seo","theme","updater"],type_value:"string",validate_as:"text",max_lenght:"50",min_lenght:"5",handle_as:"input",input_type:"text",type_values_options:["string","number","boolean"],handle_as_options:["input","switch"],input_type_options:["text","textarea","select","button","switch","checkbox","color","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","time","url","week"],readonly:!1,true_value:""},computed:{btnEnable:function(){let e=!!this.form.fields.config_name.value&&!!this.config_value||!1;return e}},filters:{capitalize:function(e){return e?(e=e.toString()).charAt(0).toUpperCase()+e.slice(1):""}},methods:{autoSave(){this.status||(this.runSaveData(),this.debug&&console.log("running autosave..."))},validateField(e){let t=UserNewForm;if(!t.form.validateField(e))return t.form.fields[e].valid;t.serverValidation(e)},validateForm(){this.form.validate();return 0==this.form.errors.length&&!0},save(){this.validateForm()?(this.loader=!0,this.runSaveData(e=>{M.toast({html:"<span>Config saved </span>"})})):M.toast({html:"Verifique todos los campos del formulario"})},runSaveData(e){var t=this,i=BASEURL+"api/v1/config";$.ajax({type:"POST",url:i,data:t.getData(),dataType:"json",success:function(a){t.debug&&console.log(i,a),setTimeout(()=>{t.loader=!1},1500),200==a.code?(t.editMode=!0,t.site_config_id=a.data.site_config_id,"function"==typeof e&&e(a)):(M.toast({html:a.error_message}),t.loader=!1)},error:function(e){t.loader=!1,M.toast({html:"OcurriÃ³ un error inesperado"}),console.error(error)}})},getData:function(){return{site_config_id:this.site_config_id||"",config_value:this.config_value||"",config_label:this.config_label||this.form.fields.config_name.value,config_name:this.form.fields.config_name.value.toUpperCase().split(" ").join("_")||"",config_description:this.config_description||"",config_type:this.config_type||"",status:this.status?1:0,readonly:this.readonly?1:0,date_publish:this.date_publish,date_create:this.date_create,date_update:this.date_update,config_data:{type_value:this.type_value,validate_as:this.validate_as,max_lenght:this.max_lenght,min_lenght:this.min_lenght,handle_as:this.handle_as,input_type:this.input_type,perm_values:this.getTags(),true:this.true_value}}},getSelectedCategorie(){return this.site_configs.filter((e,t)=>this.site_config_id==e.site_config_id)},serverValidation(e){var t=this,i=BASEURL+"admin/usuarios/ajax_check_field";$.ajax({type:"POST",url:i,data:{field:e,value:t.form.fields[e].value},dataType:"json",success:function(a){t.debug&&console.log(i,a),a.code&&(t.form.fields[e].valid=a.data,a.data?t.form.markFieldAsValid(e):t.form.fields[e].errorText="The "+e+" is already registered",t.$forceUpdate())}})},onChangeTypeValue(){switch(console.log(this.type_value),this.type_value){case"string":this.validate_as="text",this.handle_as="input",this.input_type="text";break;case"number":this.validate_as="number",this.handle_as="input",this.input_type="number";break;case"boolean":this.validate_as="boolean",this.handle_as="switch",this.input_type="switch";break;default:this.validate_as="text",this.handle_as="text"}},checkEditMode(){var e=this;if(site_config_id&&"edit"==editMode){e.editMode=!0;var t=BASEURL+"api/v1/config/"+site_config_id;fetch(t).then(e=>e.json()).then(i=>{e.loader=!1,e.debug&&console.log(t,i),200==i.code&&(e.site_config_id=i.data.site_config_id,e.date_create=i.data.date_create,e.date_publish=i.data.date_publish,e.date_update=i.data.date_update,e.config_description=i.data.config_description,e.form.fields.config_name.value=i.data.config_name,e.status=i.data.status,e.config_type=i.data.config_type,e.user_id=i.data.user_id,e.user=new User(i.data.user),setTimeout(()=>{tinymce.editors.id_cazary.setContent(e.config_description)},5e3)),setTimeout(()=>{M.updateTextFields()},1e3)}).catch(t=>{M.toast({html:t.error_message}),e.loader=!1})}else e.loader=!1},initSelects(){setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},1e3)},initPlugins(){tinymce.init({selector:"textarea",plugins:["link table code"],setup:e=>{e.on("Change",e=>{this.description=tinymce.editors.id_cazary.getContent()})}}),M.Chips.init(document.getElementById("tags"),{placeholder:"Enter a value"}),setTimeout(()=>{M.Chips.getInstance(document.getElementById("tags")).options.onChipAdd=e=>{let t=this.getTags();""==this.config_value&&(this.config_value=t[0],setTimeout(()=>{M.updateTextFields()},1e3))}},2e3)},getTags(){let e=[];return M.Chips.getInstance(document.getElementById("tags")).chipsData.forEach(t=>{e.push(t.tag.trim().toUpperCase())}),setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{}),this.initMaterialboxed()},1e3),e}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("mounted ConfigNewForm"),this.initPlugins(),this.checkEditMode()}))}});