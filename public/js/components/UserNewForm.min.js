var UserNewForm=new Vue({el:"#root",data:{debug:DEBUGMODE,loader:!0,editMode:!1,user_id:"",usergroups:[],form:new VueForm({username:{value:null,required:!0,type:"username",maxLength:15,minLength:5},password:{value:null,required:!0,type:"password",maxLength:25,minLength:5},email:{value:"",required:!0,type:"email",maxLength:150},usergroup_id:{value:"",required:!0,type:"number"},nombre:{value:"",required:!0,type:"name",maxLength:15,minLength:3},apellido:{value:"",required:!0,type:"name",maxLength:15,minLength:3},telefono:{value:"",required:!0,type:"phone",maxLength:18},direccion:{value:"",required:!0,type:"address",maxLength:60}}),status:!0},computed:{btnEnable:function(){let e=!0;for(const r in this.validFields)if(this.validFields.hasOwnProperty(r)){this.validFields[r]||(e=!1)}return e}},methods:{validateField(e){let r=UserNewForm;if(!r.form.validateField(e))return r.form.fields[e].valid;r.serverValidation(e)},save(){var e=this;if(e.form.validate(),0==e.form.errors.length){this.loader=!0;var r=BASEURL+"api/v1/users/";$.ajax({type:"POST",url:r,data:e.getUserData(),dataType:"json",success:function(a){e.debug&&console.log(r,a),200==a.code?(console.log(a),window.location=BASEURL+"admin/usuarios/ver/"+a.data.user_id):(M.toast({html:a.responseJSON.error_message}),e.loader=!1)},error:function(r){M.toast({html:r.responseJSON.error_message}),e.loader=!1}})}else M.toast({html:"Verifique todos los campos del formulario"})},getUserData(){let e=this.form.fields;return{user_id:this.user_id,username:e.username.value,password:e.password.value,email:e.email.value,usergroup_id:e.usergroup_id.value,user_data:{nombre:e.nombre.value,apellido:e.apellido.value,direccion:e.direccion.value,telefono:e.telefono.value}}},serverValidation(e){var r=this,a=BASEURL+"admin/usuarios/ajax_check_field";$.ajax({type:"POST",url:a,data:{field:e,value:r.form.fields[e].value},dataType:"json",success:function(s){r.debug&&console.log(a,s),s.code&&(r.form.fields[e].valid=s.data,s.data?r.form.markFieldAsValid(e):r.form.fields[e].errorText="The "+e+" is already registered",r.$forceUpdate())}})},getUsergroups(){var e=this,r=BASEURL+"api/v1/users/usergroups";$.ajax({type:"GET",url:r,data:{},dataType:"json",success:function(a){e.debug&&console.log(r,a),200==a.code&&(e.usergroups=a.data,setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},2e3),e.loader=!1)},error:function(r){M.toast({html:r.responseJSON.error_message}),e.loader=!1}})},checkEditMode(){if(user_id){var e=this;e.editMode=!0;var r=BASEURL+"api/v1/users/"+user_id;$.ajax({type:"GET",url:r,data:{},dataType:"json",success:function(a){if(e.debug&&console.log(r,a),200==a.code){let r=a.data;e.user_id=r.user_id,e.form.fields.username.value=r.username,e.form.fields.email.value=r.email,e.status=r.status,e.form.fields.usergroup_id.value=r.usergroup_id,e.form.fields.nombre.value=r.user_data.nombre,e.form.fields.apellido.value=r.user_data.apellido,e.form.fields.direccion.value=r.user_data.direccion,e.form.fields.telefono.value=r.user_data.telefono}e.loader=!1,setTimeout(()=>{M.updateTextFields()},1e3)},error:function(r){M.toast({html:response.responseJSON.error_message}),e.loader=!1}})}}},mounted:function(){this.$nextTick((function(){self.debug&&console.log("mounted UserNewForm"),this.getUsergroups(),this.checkEditMode()}))}});