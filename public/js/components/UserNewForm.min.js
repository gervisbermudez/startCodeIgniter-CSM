var UserNewForm=new Vue({el:"#root",data:{loader:!0,editMode:!1,user_id:"",usergroups:[],form:new VueForm({username:{value:null,required:!0,type:"username",maxLength:15,minLength:5},password:{value:null,required:!0,type:"password",maxLength:25,minLength:5},email:{value:"",required:!0,type:"email",maxLength:150},usergroup_id:{value:"",required:!0,type:"number"},nombre:{value:"",required:!0,type:"name",maxLength:15,minLength:3},apellido:{value:"",required:!0,type:"name",maxLength:15,minLength:3},telefono:{value:"",required:!0,type:"number",maxLength:12},direccion:{value:"",required:!0,type:"alphanumeric",maxLength:60}}),status:!0},computed:{btnEnable:function(){let e=!0;for(const r in this.validFields)if(this.validFields.hasOwnProperty(r)){this.validFields[r]||(e=!1)}return e}},methods:{validateField(e){let r=UserNewForm;if(!r.form.validateField(e))return r.form.fields[e].valid;r.serverValidation(e)},save(){var e=this;e.form.validate(),0==e.form.errors.length?(this.loader=!0,$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_save_user",data:e.getUserData(),dataType:"json",success:function(r){200==r.code?(console.log(r),window.location=BASEURL+"admin/usuarios/ver/"+r.data.user_id):(M.toast({html:r.responseJSON.error_message}),e.loader=!1)},error:function(r){M.toast({html:r.responseJSON.error_message}),e.loader=!1}})):M.toast({html:"Verifique todos los campos del formulario"})},getUserData(){let e=this.form.fields;return{user_id:this.user_id,username:e.username.value,password:e.password.value,email:e.email.value,usergroup_id:e.usergroup_id.value,user_data:{nombre:e.nombre.value,apellido:e.apellido.value,direccion:e.direccion.value,telefono:e.telefono.value}}},serverValidation(e){var r=this;$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_check_field",data:{field:e,value:r.form.fields[e].value},dataType:"json",success:function(a){a.code&&(r.form.fields[e].valid=a.data,a.data?r.form.markFieldAsValid(e):r.form.fields[e].errorText="The "+e+" is already registered",r.$forceUpdate())}})},getUsergroups(){var e=this;$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_get_usergroups",data:{},dataType:"json",success:function(r){200==r.code&&(e.usergroups=r.data,setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},2e3),e.loader=!1)},error:function(r){M.toast({html:response.responseJSON.error_message}),e.loader=!1}})},checkEditMode(){if(user_id){var e=this;e.editMode=!0,$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_get_users",data:{user_id:user_id},dataType:"json",success:function(r){if(200==r.code){let a=r.data[0];e.user_id=a.user_id,e.form.fields.username.value=a.username,e.form.fields.email.value=a.email,e.status=a.status,e.form.fields.usergroup_id.value=a.usergroup_id,e.form.fields.nombre.value=a.user_data.nombre,e.form.fields.apellido.value=a.user_data.apellido,e.form.fields.direccion.value=a.user_data.direccion,e.form.fields.telefono.value=a.user_data.telefono}e.loader=!1,setTimeout(()=>{M.updateTextFields()},1e3)},error:function(r){M.toast({html:response.responseJSON.error_message}),e.loader=!1}})}}},mounted:function(){this.$nextTick((function(){console.log("mounted UserNewForm"),this.getUsergroups(),this.checkEditMode()}))}});