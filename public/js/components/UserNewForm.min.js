var loginForm=new Vue({el:"#root",data:{loader:!0,editMode:!1,user_id:"",username:"",password:"",email:"",usergroup_id:"",usergroups:[],user_data:{nombre:"",apellido:"",direccion:"",telefono:""},status:!0,validFields:{username:!1,email:!1,nombre:!1,apellido:!1,direccion:!1,telefono:!1},patterns:{letters:/^[A-Za-z]+$/,email:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,numbers:/^\d+$/,alphanumeric:/^[ a-z0-9A-ZÀ-ÿ\u00f1\u00d1]*$/g}},computed:{btnEnable:function(){let e=!0;for(const a in this.validFields)if(this.validFields.hasOwnProperty(a)){this.validFields[a]||(e=!1)}return e}},methods:{save(){var e=this;this.loader=!0,$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_save_user",data:{username:e.username,password:e.password,email:e.email,usergroup_id:e.usergroup_id,user_data:e.user_data},dataType:"json",success:function(a){200==a.code?(console.log(a),window.location=BASEURL+"admin/usuarios/ver/"+a.data.user_id):(M.toast({html:a.responseJSON.error_message}),e.loader=!1)},error:function(a){M.toast({html:a.responseJSON.error_message}),e.loader=!1}})},validateField(e){switch(e){case"username":if(!this.username.match(this.patterns.letters))return this.validFields[e]=!1,void M.toast({html:"Only letters are allowed"});this.serverValidation(e);break;case"email":if(!this.email.match(this.patterns.email))return this.validFields[e]=!1,void M.toast({html:"Email invalid"});this.serverValidation(e);break;case"nombre":if(!this.user_data.nombre.match(this.patterns.letters))return this.validFields.nombre=!1,void M.toast({html:"Only letters are allowed"});break;case"apellido":if(!this.user_data.apellido.match(this.patterns.letters))return this.validFields.apellido=!1,void M.toast({html:"Only letters are allowed"});break;case"telefono":if(!this.user_data.telefono.match(this.patterns.numbers))return this.validFields.telefono=!1,void M.toast({html:"Only numbers are allowed"});break;case"direccion":if(!this.user_data.direccion.match(this.patterns.alphanumeric))return this.validFields.direccion=!1,void M.toast({html:"Simbols are not allowed"})}this.validFields[e]=!0},serverValidation(e){var a=this;$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_check_field",data:{field:e,value:a[e]},dataType:"json",success:function(s){s.code&&(a.validFields[e]=s.data,s.data||M.toast({html:"The "+e+" is already registered!"}),a.$forceUpdate())}})},getUsergroups(){var e=this;$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_get_usergroups",data:{},dataType:"json",success:function(a){200==a.code&&(e.usergroups=a.data,setTimeout(()=>{var e=document.querySelectorAll("select");M.FormSelect.init(e,{})},2e3),e.loader=!1)},error:function(a){M.toast({html:response.responseJSON.error_message}),e.loader=!1}})},checkEditMode(){if(user_id){var e=this;e.editMode=!0,$.ajax({type:"POST",url:BASEURL+"admin/usuarios/ajax_get_users",data:{user_id:user_id},dataType:"json",success:function(a){if(200==a.code){let s=a.data[0];e.user_id=s.user_id,e.username=s.username,e.email=s.email,e.status=s.status,e.usergroup_id=s.usergroup_id,e.user_data.nombre=s.user_data.nombre,e.user_data.apellido=s.user_data.apellido,e.user_data.direccion=s.user_data.direccion,e.user_data.telefono=s.user_data.telefono}e.loader=!1,setTimeout(()=>{M.updateTextFields()},1e3)},error:function(a){M.toast({html:response.responseJSON.error_message}),e.loader=!1}})}}},mounted:function(){this.$nextTick((function(){console.log("mounted UserNewForm"),this.getUsergroups(),this.checkEditMode()}))}});