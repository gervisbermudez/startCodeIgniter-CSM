var MenuNewForm=new Vue({el:"#root",data:{debug:DEBUGMODE,loader:!0,editMode:!1,menu_id:null,form:{},name:"",status:!1,date_publish:"",date_create:"",date_update:"",template:"",menu_items:[],templates:[],categories_type:["page","formulario","video","foto","evento","contenido"],user_id:null,user:null},computed:{btnEnable:function(){return!!(this.name&&this.template&&this.menu_items.length>0)}},filters:{capitalize:function(e){return e?(e=e.toString()).charAt(0).toUpperCase()+e.slice(1):""}},methods:{autoSave(){this.status||(this.runSaveData(),this.debug&&console.log("running autosave..."))},validateField(e){let t=UserNewForm;if(!t.form.validateField(e))return t.form.fields[e].valid;t.serverValidation(e)},validateForm(){this.form.validate();return 0==this.form.errors.length&&!0},save(){this.loader=!0,this.runSaveData(e=>{M.toast({html:"<span>Menu saved </span>"})})},runSaveData(e){var t=this,a=BASEURL+"api/v1/menus";$.ajax({type:"POST",url:a,data:t.getData(),dataType:"json",success:function(i){t.debug&&console.log(a,i),setTimeout(()=>{t.loader=!1},1500),200==i.code?(t.editMode=!0,t.menu_id=i.data.menu_id,"function"==typeof e&&e(i)):(M.toast({html:i.responseJSON.error_message}),t.loader=!1)},error:function(e){M.toast({html:e.responseJSON.error_message}),t.loader=!1}})},getData:function(){return{menu_id:this.menu_id||"",name:this.name||"",template:this.template||"",status:this.status?1:0,menu_items:this.menu_items}},getSelectedCategorie(){return this.categories.filter((e,t)=>this.menu_id==e.menu_id)},getTemplates(){var e=BASEURL+"api/v1/menus/templates/";fetch(e).then(e=>e.json()).then(t=>{this.loader=!1,this.debug&&console.log(e,t),200==t.code&&(this.templates=t.data.map(e=>e.split(".")[0]),this.initPlugins())}).catch(e=>{this.debug&&console.log(e),this.loader=!1})},checkEditMode(){var e=this;if(menu_id&&"edit"==editMode){e.editMode=!0;var t=BASEURL+"api/v1/menus/"+menu_id;fetch(t).then(e=>e.json()).then(a=>{e.loader=!1,e.debug&&console.log(t,a),200==a.code&&(e.menu_id=a.data.menu_id,e.name=a.data.name,e.template=a.data.template,e.date_create=a.data.date_create,e.date_publish=a.data.date_publish,e.status=a.data.status,e.user_id=a.data.user_id,e.menu_items=a.data.menu_items,e.user=new User(a.data.user)),this.initPlugins()}).catch(t=>{M.toast({html:t.responseJSON.error_message}),e.loader=!1})}else e.loader=!1},addItem(){this.menu_items.push({menu_item_id:"",menu_id:this.menu_id,menu_item_parent_id:"0",item_type:"static_link",item_name:"new-item",item_label:"",item_link:"",item_title:"",item_target:"_self",date_publish:"",date_create:"",date_update:"",status:"1",subitems:[]})},removeItem(e){this.menu_items.splice(e,1)},initPlugins(){var e=document.querySelector(".collapsible.expandable"),t=(M.Collapsible.init(e,{accordion:!1}),document.querySelectorAll("select"));M.FormSelect.init(t,{});var a=$(".collapsible.expandable").sortable({handle:".collapsible-header i",delay:500,onDrop:(e,t,i)=>{var s=a.sortable("serialize");console.log("onDrop",s),i(e,t)}})}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("mounted MenuNewForm"),this.getTemplates(),this.checkEditMode()}))}});