Vue.component("formFieldTitle",{template:"#formFieldTitle-template",props:["tab-parent","field-ref","field-ref-index","serve-data"],data:function(){return{fieldPlaceholder:"",fieldID:this.makeid(10),fieldName:"",fielApiID:""}},methods:{convertfielApiID(){this.fielApiID=this.fieldName.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""),this.fieldPlaceholder=this.fieldName.toLowerCase()},makeid(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,i=0;i<e;i++)t+=a.charAt(Math.floor(Math.random()*o));return t}},mounted:function(){this.$nextTick((function(){for(const e in this.serveData)if(this.serveData.hasOwnProperty(e)){const t=this.serveData[e];this[e]=t}}))}});var formModule=new Vue({el:"#formModule",data:{debug:DEBUGMODE,editMode:!1,loader:!0,tabs:[],formsElements:[{name:"title",displayName:"Titulo",icon:"format_color_text",component:"formFieldTitle",data:{hola:"mundo"}},{name:"formatText",displayName:"Texto con formato",icon:"format_size",data:{hola:"mundo"}},{name:"image",displayName:"Imagen",icon:"image",data:{hola:"mundo"}},{name:"link",displayName:"Link",icon:"insert_link",data:{hola:"mundo"}},{name:"date",displayName:"Fecha",icon:"date_range",data:{hola:"mundo"}},{name:"timestamp",displayName:"Fecha y Hora",icon:"access_time",data:{hola:"mundo"}},{name:"number",displayName:"Numero",icon:"looks_one",data:{hola:"mundo"}},{name:"dropdown_select",displayName:"Select",icon:"list",data:{hola:"mundo"}},{name:"bolean",displayName:"Bolean",icon:"check_circle",data:{hola:"mundo"}}],form_name:"Nuevo Formulario",form_status:!0},methods:{getInitialTab(){return{name:"Tab "+(this.tabs.length+1),tabID:this.makeid(10),edited:!0,active:!0,fields:[]}},setActive(e){this.tabs.map(e=>(e.active=!1,e)),this.tabs[e].active=!0},addTab(){this.debug&&console.log("addTab trigger"),this.tabs.push(this.getInitialTab()),this.setActive(this.tabs.length-1)},saveTab(e){this.debug&&console.log("saveTab trigger"),this.tabs[e].edited=!1},makeid(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,i=0;i<e;i++)t+=a.charAt(Math.floor(Math.random()*o));return t},deleteTab(e){if(this.debug&&console.log("deleteTab trigger"),1==this.tabs.length)return!1;this.tabs.splice(e,1)},getActiveTab(){let e;return this.tabs.forEach((t,a)=>{t.active&&(e=a)}),e},addField(e){this.debug&&console.log("addField trigger"),this.tabs[this.getActiveTab()].fields.push(JSON.parse(JSON.stringify(e))),setTimeout(()=>{var e=document.querySelectorAll(".collapsible");M.Collapsible.init(e,{})},2e3)},getfieldsData(){this.debug&&console.log("getfieldsData trigger"),fieldsComponents=formModule.$refs;for(const e in fieldsComponents)if(fieldsComponents.hasOwnProperty(e)){const t=fieldsComponents[e];for(let e=0;e<t.length;e++){const a=t[e];formModule.setFieldData(a.tabParent.tabID,a.fieldRefIndex,JSON.parse(JSON.stringify(a.$data)))}}},setFieldData(e,t,a){this.debug&&console.log("setFieldData trigger"),this.tabs.map(o=>{o.tabID==e&&(o.fields[t].data=a)})},saveData(){$("html, body").animate({scrollTop:0},600),this.loader=!0,this.debug&&console.log("saveData trigger"),this.getfieldsData();let e={form_name:this.form_name,form_status:this.form_status?1:0,tabs:{}};if(this.tabs.forEach(t=>{if(t.fields.length<0)return!1;e.tabs[t.name]={tab_name:t.name,fields:t.fields}}),this.editMode){e.form_id=form_id;var t=BASEURL+"admin/formularios/updateForm";$.ajax({type:"POST",url:t,data:{data:JSON.stringify(e)},dataType:"json",success:function(e){self.debug&&console.log(t,e),e.data&&(window.location=BASEURL+"admin/formularios/")},error:function(e){self.loader=!1,M.toast({html:"Ha ocurrido un error"})}})}else{t=BASEURL+"admin/formularios/saveForm";$.ajax({type:"POST",url:t,data:{data:JSON.stringify(e)},dataType:"json",success:function(e){self.debug&&console.log(t,e),e.data&&(window.location=BASEURL+"admin/formularios/")},error:function(e){self.loader=!1,M.toast({html:e.responseJSON.error_message})}})}},checkEditMode(){if("undefined"!=typeof form_id){var e=this;e.editMode=!0,e.form_id=form_id,console.log("editMode"),$.ajax({type:"GET",url:"/admin/formularios/get_form_info/"+form_id,data:{},dataType:"json",success:function(t){console.log(t),e.updateFormData(t.data)}})}else this.loader=!1},updateFormData(e){this.form_name=e[0].form_name,this.form_status="1"==e[0].status,this.loader=!1,this.tabs=[],e.forEach(e=>{let t=this.getInitialTab();t.edited=!1,t.active=!1,t.name=e.tab_name,console.log(e.fields_data);let a={};e.fields_data.forEach(e=>{a={component:e.component,displayName:e.displayName,icon:e.icon,name:e.field_name,serveData:e.dataconfigs},t.fields.push(a)}),this.tabs.push(t)}),this.tabs[0].active=!0,setTimeout(()=>{var e=document.querySelectorAll(".collapsible");M.Collapsible.init(e,{})},2e3)}},mounted:function(){this.$nextTick((function(){this.debug&&console.log("formModule mounted"),this.tabs.push(this.getInitialTab()),this.tabs[0].edited=!1,this.checkEditMode()}))}});